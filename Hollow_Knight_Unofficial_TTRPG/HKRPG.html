<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab"  value="character"  />
<div>
    <button type="action" name="act_page1">Page 1</button>
    <button type="action" name="act_page2">Page 2</button>
    <button type="action" name="act_modifiers">Modifiers and Etc.</button>
</div>

<div class="sheet-page2">
    <h2>Character</h2>
        <h4>Work in Progress, this page will include spells, paths, social rolls, and other features I forgot to add (which will hopefully be made apparent through this beta test)</h4>
</div>

<div class="sheet-modifiers">
    <h2>Modifiers</h2>

  <p><div class="unimod">
      <input type="number" name="attr_unimod" style="width: 43px;">{WORK IN PROGRESS} Universal Bonus</div></p>
  
  <div class="soakmod">
      <p>Normal Resist:
      <input type="number" name="attr_soakmod" style="width: 43px;">+Soak&nbsp;&nbsp;
      <input type="number" name="attr_soakrerollmod" style="width: 43px;">+Soak Reroll</p></div>
  <p><div class="soakmagicmod">
      Magical Resist:
      <input type="number" name="attr_soakmagicmod" style="width: 43px;">+Soak&nbsp;&nbsp;
      <input type="number" name="attr_soakmagicrerollmod" style="width: 43px;">+Soak Reroll</div>
  <div class="soakmagicradio">
      <input type="radio" name="attr_soakmagicradio" value="1" style="width: 43px;">Add "Normal" Soak against Magic Damage&nbsp;&nbsp;
      <input type="radio" name="attr_soakmagicradio" value="0" style="width: 43px;" checked>Don't do that</div></p>
  <p><div class="soakenviromod">
      Enviornmental Resist:
      <input type="number" name="attr_soakenviromod" style="width: 43px;">+Soak&nbsp;&nbsp;
      <input type="number" name="attr_soakenvirorerollmod" style="width: 43px;">+Soak Reroll</div>
  <div class="soakenviroradio">
      <input type="radio" name="attr_soakenviroradio" value="1" style="width: 43px;">Add "Normal" Soak against Enviornment Damage&nbsp;&nbsp;
      <input type="radio" name="attr_soakenviroradio" value="0" style="width: 43px;" checked>Don't do that</div></p>
      
  <p><div class="loadmod">
      <input type="number" name="attr_loadmod" style="width: 43px;">+Load</div>
  <div class="footworkmod">
      <input type="number" name="attr_footworkmod" style="width: 43px;">+Footwork</div>
  <div class="beltmod">
      <input type="number" name="attr_beltmod" style="width: 43px;">+Belt</div>
  <div class="initmod">
      <input type="number" name="attr_initmod" style="width: 43px;">+Initative&nbsp;&nbsp;
      <input type="number" name="attr_initrerollmod" style="width: 43px;">+Initative Reroll</div></p>

  <p><div class="cutespook">
      <input type="number" name="attr_cutererollmod" style="width: 43px;">+Cute Reroll&nbsp;&nbsp;
      <input type="number" name="attr_spookrerollmod" style="width: 43px;">+Spook Reroll</div></p>
  
  <p><div class="bellylostmod">
      <input type="number" name="attr_bellylostmod" style="width: 43px;">{WORK IN PROGRESS} Custom Belly Lost</div></p>
      
  <p><div class="stamtaxinstantmod">
      <input type="number" name="attr_stamtaxinstantmod" style="width: 43px;">+Stamina Tax</div>
  <div class="stamtaxmod">
      <input type="number" name="attr_stamtaxmod" style="width: 43px;">+Stamina Tax (upon clicking "Start Turn")</div>
  <div class="stamtaxtax">
      <input type="number" name="attr_stamtaxtax" style="width: 43px;">+Stamina Tax (upon clicking "Attack")</div></p>
      
  <p><div class="stamattackmod">
      <input type="number" name="attr_stamattackmod" style="width: 43px;">+Stamina Cost (Attack)</div>
  <div class="stamparrymod">
      <input type="number" name="attr_stamparrymod" style="width: 43px;">+Stamina Cost (Parry)</div>
  <div class="stamdodgemod">
      <input type="number" name="attr_stamdodgemod" style="width: 43px;">+Stamina Cost (Dodge)</div>
  <div class="stamgrapplemod">
      <input type="number" name="attr_stamgrapplemod" style="width: 43px;">+Stamina Cost (Grapple)</div></p>
      
<p><div class="mtoggle">
    Have Melee Attacks use:
      <input type="radio" name="attr_meleeradio" value="1" style="width: 13px;" checked>Might&nbsp;&nbsp;
      <input type="radio" name="attr_meleeradio" value="2" style="width: 13px;">Grace&nbsp;&nbsp;
      <input type="radio" name="attr_meleeradio" value="3" style="width: 13px;">Insight</div></p>

<p><div class="rtoggle">
    Have Ranged Attacks use:
      <input type="radio" name="attr_rangedradio" value="1" style="width: 13px;">Might&nbsp;&nbsp;
      <input type="radio" name="attr_rangedradio" value="2" style="width: 13px;" checked>Grace&nbsp;&nbsp;
      <input type="radio" name="attr_rangedradio" value="3" style="width: 13px;">Insight</div></p>

  <p><div class="grapplerollmod">
      <input type="number" name="attr_grapplerollmod" style="width: 43px;">+Grapple&nbsp;&nbsp;
      <input type="number" name="attr_grapplererollmod" style="width: 43px;">+Grapple Reroll</div>
  <div class="grapplearms">
      <input type="number" name="attr_grapplearms" min="0" max="2" style="width: 43px;">Additional Arms for Grappling (beyond the first)</div></p>

<p><div class="attackbuff">
      <input type="number" name="attr_attackbuff" style="width: 43px;">+Attack Dice&nbsp;&nbsp;
      <input type="number" name="attr_attackrerollbuff" style="width: 43px;">+Attack Reroll</div>
  <div class="mightattackmod">
      <input type="number" name="attr_mightattackmod" style="width: 43px;">+Attack Dice (Might)&nbsp;&nbsp;
      <input type="number" name="attr_mightattackrerollmod" style="width: 43px;">+Attack Reroll (Might)</div>
  <div class="graceattackmod">
      <input type="number" name="attr_graceattackmod" style="width: 43px;">+Attack Dice (Grace)&nbsp;&nbsp;
      <input type="number" name="attr_graceattackrerollmod" style="width: 43px;">+Attack Reroll (Grace)</div>
  <div class="insightattackmod">
      <input type="number" name="attr_insightattackmod" style="width: 43px;">+Attack Dice (Insight)&nbsp;&nbsp;
      <input type="number" name="attr_insightattackrerollmod" style="width: 43px;">+Attack Reroll (Insight)</div>
  <div class="dodgebuff">
      <input type="number" name="attr_dodgebuff" style="width: 43px;">+Dodge Dice&nbsp;&nbsp;
      <input type="number" name="attr_dodgererollbuff" style="width: 43px;">+Dodge Reroll</div>
  <div class="parrybuff">
      <input type="number" name="attr_parrybuff" style="width: 43px;">+Parry Dice&nbsp;&nbsp;
      <input type="number" name="attr_parryrerollbuff" style="width: 43px;">+Parry Reroll</div>
  <div class="parryweaponbuff">
      <input type="number" name="attr_parryweaponbuff" style="width: 43px;">+Parry Dice (Weapon Specific)&nbsp;&nbsp;
      <input type="number" name="attr_parryweaponrerollbuff" style="width: 43px;">+Parry Reroll (Weapon Specific)</div>
  <div class="parryshieldbuff">
      <input type="number" name="attr_parryshieldbuff" style="width: 43px;">+Parry Dice (Shield Specific)&nbsp;&nbsp;
      <input type="number" name="attr_parryshieldrerollbuff" style="width: 43px;">+Parry Reroll (Shield Specific)</div></p>
  
  <p><div class="shieldbashradio">
      Apply "Balanced Modifier" to:
      <input type="checkbox" name="attr_shieldbashradio1" value="1" style="width: 10px;" unchecked>Shield Slot 1&nbsp;&nbsp;
      <input type="checkbox" name="attr_shieldbashradio2" value="1" style="width: 10px;" unchecked>Shield Slot 2&nbsp;&nbsp;
      <input type="checkbox" name="attr_shieldbashradio3" value="1" style="width: 10px;" unchecked>Shield Slot 3&nbsp;&nbsp;
      <input type="checkbox" name="attr_shieldbashradio4" value="1" style="width: 10px;" unchecked>Shield Slot 4&nbsp;&nbsp;
      <input type="checkbox" name="attr_shieldbashradio5" value="1" style="width: 10px;" unchecked>Shield Slot 5</div>

  <div class="shieldqtybonus">
      Bonus Shield Quality Upgrades and modifiers (input the shield's base quality in page 1's "Weapons & Shields"):
      <input type="number" name="attr_shieldqtybonus1" style="width: 43px;">Shield Slot 1&nbsp;&nbsp;
      <input type="number" name="attr_shieldqtybonus2" style="width: 43px;">Shield Slot 2&nbsp;&nbsp;
      <input type="number" name="attr_shieldqtybonus3" style="width: 43px;">Shield Slot 3&nbsp;&nbsp;
      <input type="number" name="attr_shieldqtybonus4" style="width: 43px;">Shield Slot 4&nbsp;&nbsp;
      <input type="number" name="attr_shieldqtybonus5" style="width: 43px;">Shield Slot 5</div></p>

  <p><div class="damredbuff">
      <input type="number" name="attr_damredbuff" style="width: 43px;">+Damage Reduction</div>
  <div class="damriskbuff">
      <input type="number" name="attr_damriskbuff" style="width: 43px;">+Damage Risk</div></p>
      
  <p><div class="mightcheckbuff">
      <input type="number" name="attr_mightcheckbuff" style="width: 43px;">+Might Based Rolls&nbsp;&nbsp;
      <input type="number" name="attr_mightrerollmod" style="width: 43px;">+Might Reroll</div>
  <div class="shellcheckbuff">
      <input type="number" name="attr_shellcheckbuff" style="width: 43px;">+Shell Based Rolls&nbsp;&nbsp;
      <input type="number" name="attr_shellrerollmod" style="width: 43px;">+Shell Reroll</div>
  <div class="insightcheckbuff">
      <input type="number" name="attr_insightcheckbuff" style="width: 43px;">+Insight Based Rolls&nbsp;&nbsp;
      <input type="number" name="attr_insightrerollmod" style="width: 43px;">+Insight Reroll</div>
  <div class="gracecheckbuff">
      <input type="number" name="attr_gracecheckbuff" style="width: 43px;">+Grace Based Rolls&nbsp;&nbsp;
      <input type="number" name="attr_gracererollmod" style="width: 43px;">+Grace Reroll</div></p>
      
  <p><div class="setsuccessattack">
      <input type="number" name="attr_setsuccessattack" value="5" min="1" max="6" style="width: 43px;">Threadshold for Success (Attack)</div>
  <div class="setsuccessparry">
      <input type="number" name="attr_setsuccessparry" value="5" min="1" max="6" style="width: 43px;">Threadshold for Success (Parry)</div>
  <div class="setsuccessdodge">
      <input type="number" name="attr_setsuccessdodge" value="5" min="1" max="6" style="width: 43px;">Threadshold for Success (Dodge)</div>
  <div class="setsuccesssoak">
      <input type="number" name="attr_setsuccesssoak" value="5" min="1" max="6" style="width: 43px;">Threadshold for Success (Soak)</div></p>


</div>

<script type="text/worker">
    const buttonlist = ["page1","page2","modifiers"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });
on(`sheet:opened`, function() {
    getAttrs(['page1'], function(values) {
            setAttrs({
                sheetTab: page1
            });
        });
    });




</script>

<div class="sheet-page1">
<div class="container">

<div class="image">
    <img src="https://i.imgur.com/D9oBFIW.png" alt="sheet"></div>
  
  <div class="might">
      <input type="text" name="attr_might" value="3" min="0" step="0.5" style="width: 33px;"></div>  

  <div class="might-mod">
      <input type="text" name="attr_mightmod" min="0" style="width: 33px;"></div> 
  
  <div class="insight">
      <input type="text" name="attr_insight" value="3" min="0" step="0.5" style="width: 33px;"></div>  

  <div class="insight-mod">
      <input type="text" name="attr_insightmod" min="0" style="width: 33px;"></div> 
  
  <div class="shell">
      <input type="text" name="attr_shell" value="3" min="0" step="0.5" style="width: 33px;"></div>  
  
  <div class="shell-mod">
      <input type="text" name="attr_shellmod" min="0" style="width: 33px;"></div>   
  
  <div class="grace">
      <input type="text" name="attr_grace" value="3" min="0" step="0.5" style="width: 33px;"></div>

  <div class="grace-mod">
      <input type="text" name="attr_gracemod" min="0" style="width: 33px;"></div> 
      
  <div class="grapplefinal">
      <input type="text" name="attr_grapplefinal" min="0" step="0.5" style="width: 34px;" readonly></div>
      
 <div class="grappletoggle">
      <input type="radio" name="attr_grappletoggle" value="1" checked/>Atk.&nbsp;&nbsp;
      <input type="radio" name="attr_grappletoggle" value="2"/>Retain</div>

 <div class="checkmight">
    <button type="roll" name="roll_checkmight" value="&{template:checkmight} {{name=Checkmight}} {{mightcheck=[[@{mighttotal}d6s>5]]}} {{mightreroll=[[@{mightreroll}d6s>5]]}}"></div>
 <div class="checkinsight">
    <button type="roll" name="roll_checkinsight" value="&{template:checkinsight} {{name=Checkinsight}} {{insightcheck=[[@{insighttotal}d6s>5]]}} {{insightreroll=[[@{insightreroll}d6s>5]]}}"></div>
 <div class="checkshell">
    <button type="roll" name="roll_checkshell" value="&{template:checkshell} {{name=Checkshell}} {{shellcheck=[[@{shelltotal}d6s>5]]}} {{shellreroll=[[@{shellreroll}d6s>5]]}}"></div>
 <div class="checkgrace">
    <button type="roll" name="roll_checkgrace" value="&{template:checkgrace} {{name=Checkgrace}} {{gracecheck=[[@{gracetotal}d6s>5]]}} {{gracereroll=[[@{gracereroll}d6s>5]]}}"></div>
 <div class="checkcute">
    <button type="roll" name="roll_checkcute" value="&{template:checkcute} {{name=Checkcute}} {{cutecheck=[[@{cutetotal}d6s>5]]}} {{cutereroll=[[@{cutereroll}d6s>5]]}}"></div>
 <div class="checkspook">
    <button type="roll" name="roll_checkspook" value="&{template:checkspook} {{name=Checkspook}} {{spookcheck=[[@{spooktotal}d6s>5]]}} {{spookreroll=[[@{spookreroll}d6s>5]]}}"></div>

  <div class="eqmnt1">
      <input type="text" name="attr_eqmnt1" style="width: 230px;"></div>
  <div class="eqmnt1load">
      <input type="text" name="attr_eqmnt1load" style="width: 27px;"></div>
  <div class="eqmnt2">
      <input type="text" name="attr_eqmnt2" style="width: 230px;"></div>
  <div class="eqmnt2load">
      <input type="text" name="attr_eqmnt2load" style="width: 27px;"></div>
  <div class="eqmnt3">
      <input type="text" name="attr_eqmnt3" style="width: 230px;"></div>
  <div class="eqmnt3load">
      <input type="text" name="attr_eqmnt3load" style="width: 27px;"></div>
  <div class="eqmnt4">
      <input type="text" name="attr_eqmnt4" style="width: 230px;"></div>
  <div class="eqmnt4load">
      <input type="text" name="attr_eqmnt4load" style="width: 27px;"></div>
  <div class="eqmnt5">
      <input type="text" name="attr_eqmnt5" style="width: 230px;"></div>
  <div class="eqmnt5load">
      <input type="text" name="attr_eqmnt5load" style="width: 27px;"></div>
  <div class="eqmnt6">
      <input type="text" name="attr_eqmnt6" style="width: 230px;"></div>
  <div class="eqmnt6load">
      <input type="text" name="attr_eqmnt6load" style="width: 27px;"></div>
  <div class="eqmnt7">
      <input type="text" name="attr_eqmnt7" style="width: 230px;"></div>
  <div class="eqmnt7load">
      <input type="text" name="attr_eqmnt7load" style="width: 27px;"></div>
  <div class="eqmnt8">
      <input type="text" name="attr_eqmnt8" style="width: 230px;"></div>
  <div class="eqmnt8load">
      <input type="text" name="attr_eqmnt8load" style="width: 27px;"></div>
  <div class="eqmnt9">
      <input type="text" name="attr_eqmnt9" style="width: 230px;"></div>
  <div class="eqmnt9load">
      <input type="text" name="attr_eqmnt9load" style="width: 27px;"></div>
  <div class="eqmnt10">
      <input type="text" name="attr_eqmnt10" style="width: 230px;"></div>
  <div class="eqmnt10load">
      <input type="text" name="attr_eqmnt10load" style="width: 27px;"></div>

  <div class="result1">
      <input type="text" name="attr_result1" step="0.5" style="width: 43px;" readonly></div>
  <div class="result2">
      <input type="text" name="attr_result2" step="0.5" style="width: 43px;" readonly></div>  
  <div class="result3">
      <input type="text" name="attr_result3" step="0.5" style="width: 43px;" readonly></div>  
  <div class="result4">
      <input type="text" name="attr_result4" step="0.5" style="width: 43px;" readonly></div>  
  <div class="result5">
      <input type="text" name="attr_result5" step="0.5" style="width: 43px;" readonly></div>  

  
  <div class="weapon1">
      <input type="text" name="attr_weapon1"></div>
  <div class="weapon2">
      <input type="text" name="attr_weapon2"></div>
  <div class="weapon3">
      <input type="text" name="attr_weapon3"></div>
  <div class="weapon4">
      <input type="text" name="attr_weapon4"></div>
  <div class="weapon5">
      <input type="text" name="attr_weapon5"></div>


  <div class="bulk1">
      <input type="text" name="attr_bulk1" min="0" style="width: 33px;"></div>
  <div class="bulk2">
      <input type="text" name="attr_bulk2" min="0" style="width: 33px;"></div>
  <div class="bulk3">
      <input type="text" name="attr_bulk3" min="0" style="width: 33px;"></div>
  <div class="bulk4">
      <input type="text" name="attr_bulk4" min="0" style="width: 33px;"></div>
  <div class="bulk5">
      <input type="text" name="attr_bulk5" min="0" style="width: 33px;"></div>

      
  <div class="dmg1">
      <input type="text" name="attr_dmg1" min="0" style="width: 33px;"></div>
  <div class="dmg2">
      <input type="text" name="attr_dmg2" min="0" style="width: 33px;"></div>
  <div class="dmg3">
      <input type="text" name="attr_dmg3" min="0" style="width: 33px;"></div>
  <div class="dmg4">
      <input type="text" name="attr_dmg4" min="0" style="width: 33px;"></div>
  <div class="dmg5">
      <input type="text" name="attr_dmg5" min="0" style="width: 33px;"></div>


  <div class="rng1">
      <input type="text" name="attr_rng1" min="0" style="width: 33px;"></div>
  <div class="rng2">
      <input type="text" name="attr_rng2" min="0" style="width: 33px;"></div>
  <div class="rng3">
      <input type="text" name="attr_rng3" min="0" style="width: 33px;"></div>
  <div class="rng4">
      <input type="text" name="attr_rng4" min="0" style="width: 33px;"></div>
  <div class="rng5">
      <input type="text" name="attr_rng5" min="0" style="width: 33px;"></div>

  
  <div class="qty1">
      <input type="text" name="attr_qty1" min="-1" style="width: 33px;"></div>
  <div class="qty2">
      <input type="text" name="attr_qty2" min="-1" style="width: 33px;"></div>
  <div class="qty3">
      <input type="text" name="attr_qty3" min="-1" style="width: 33px;"></div>
  <div class="qty4">
      <input type="text" name="attr_qty4" min="-1" style="width: 33px;"></div>
  <div class="qty5">
      <input type="text" name="attr_qty5" min="-1" style="width: 33px;"></div>

<div class="bulka">
      <input type="text" name="attr_bulka" style="width: 25px;"></div>
<div class="armname">
      <input type="text" name="attr_armname"></div>
<div class="armdur">
      <input type="text" name="attr_armdur" min="0" style="width: 30px;"></div>
<div class="armdurmax">
      <input type="text" name="attr_armdurmax" min="0" style="width: 30px;"></div>
<div class="dr">
      <input type="text" name="attr_dr" style="width: 25px;"></div>  
<div class="armsoak">
      <input type="text" name="attr_armsoak" style="width: 26px;"></div>
<div class="armsoakreroll">
      <input type="text" name="attr_armsoakreroll" style="width: 26px;"></div>

  <div class="bulktotal">
      <input type="text" name="attr_bulktotal" min="0" style="width: 33px;"></div>

  <div class="load">
      <input type="text" name="attr_load" min="0" style="width: 33px;" readonly></div>

 <div class="toggle">
      <input type="radio" name="attr_toggle" value="1" checked/>Melee&nbsp;&nbsp;
      <input type="radio" name="attr_toggle" value="2"/>Ranged</div>

 <div class="equipped">
      <input type="radio" name="attr_atkequip" value="1" checked/>Atk.&nbsp;&nbsp;
      <input type="radio" name="attr_pryequip" value="1" checked/>Parry&nbsp;&nbsp;
      <input type="radio" name="attr_gplequip" value="1"/>Grapple</div>
 <div class="equipped2">
      <input type="radio" name="attr_atkequip" value="2"/>Atk.&nbsp;&nbsp;
      <input type="radio" name="attr_pryequip" value="2"/>Parry&nbsp;&nbsp;
      <input type="radio" name="attr_gplequip" value="2"/>Grapple</div>
 <div class="equipped3">
      <input type="radio" name="attr_atkequip" value="3"/>Atk.&nbsp;&nbsp;
      <input type="radio" name="attr_pryequip" value="3"/>Parry&nbsp;&nbsp;
      <input type="radio" name="attr_gplequip" value="3"/>Grapple</div>
 <div class="equipped4">
      <input type="radio" name="attr_atkequip" value="4"/>Atk.&nbsp;&nbsp;
      <input type="radio" name="attr_pryequip" value="4"/>Parry&nbsp;&nbsp;
      <input type="radio" name="attr_gplequip" value="4"/>Grapple</div>
 <div class="equipped5">
      <input type="radio" name="attr_atkequip" value="5"/>Atk.&nbsp;&nbsp;
      <input type="radio" name="attr_pryequip" value="5"/>Parry&nbsp;&nbsp;
      <input type="radio" name="attr_gplequip" value="5" checked/>Grapple</div>
      
 <div class="wpntype1">
      <input type="radio" name="attr_wpntype1" value="1" checked/>Weapon&nbsp;&nbsp;
      <input type="radio" name="attr_wpntype1" value="2"/>Shield</div>
 <div class="wpntype2">
      <input type="radio" name="attr_wpntype2" value="1" checked/>Weapon&nbsp;&nbsp;
      <input type="radio" name="attr_wpntype2" value="2"/>Shield</div>
 <div class="wpntype3">
      <input type="radio" name="attr_wpntype3" value="1" checked/>Weapon&nbsp;&nbsp;
      <input type="radio" name="attr_wpntype3" value="2"/>Shield</div>
 <div class="wpntype4">
      <input type="radio" name="attr_wpntype4" value="1" checked/>Weapon&nbsp;&nbsp;
      <input type="radio" name="attr_wpntype4" value="2"/>Shield</div>
 <div class="wpntype5">
      <input type="radio" name="attr_wpntype5" value="1" checked/>Weapon&nbsp;&nbsp;
      <input type="radio" name="attr_wpntype5" value="2"/>Shield</div>


<div class="dedicatedstamina">
    <input type="number" name="attr_dedsta" min="0" style="width: 36px;"></div>

 <div class="atkboxcovered">
      <input type="number" name="attr_atkboxcovered" min="0" max="0.75" step="0.25" style="width: 50px;"></div>

 <div class="dmgboxhit">
      <input type="text" name="attr_dmgboxhit" min="0" style="width: 34px;"></div>

<div class="atkboxgrapple">
    <input type="checkbox" name="attr_atkboxgrapple" value="1" unchecked></div>
<div class="atkboxopportunity">
    <input type="checkbox" name="attr_atkboxopportunity" value="1" unchecked></div>
<div class="atkboxpaired">
    <input type="checkbox" name="attr_atkboxpaired" value="1" unchecked></div>
<div class="atkboxsqueeze">
    <input type="checkbox" name="attr_atkboxsqueeze" value="1" unchecked></div>
<div class="atkboxunseen">
    <input type="checkbox" name="attr_atkboxunseen" value="1" unchecked></div>

<div class="defboxbulk">
    <input type="text" name="attr_defboxbulk" min="0" style="width: 34px;"></div>

<div class="defboxgrapple">
    <input type="checkbox" name="attr_defboxgrapple" value="1" unchecked></div>
<div class="defboxsqueeze">
    <input type="checkbox" name="attr_defboxsqueeze" value="1" unchecked></div>
<div class="defboxunseen">
    <input type="checkbox" name="attr_defboxunseen" value="1" unchecked></div>
<div class="defboxranged">
    <input type="checkbox" name="attr_defboxranged" value="1" unchecked></div>
<div class="defboxmove">
    <input type="checkbox" name="attr_defboxmove" value="1" unchecked></div>

<div class="softbody">
    <input type="checkbox" name="attr_softbody" value="1" unchecked></div>
    
<div class="absorption">
      <input type="text" name="attr_absorption" min="0" style="width: 23px;"></div>
<div class="absorptiondur">
      <input type="text" name="attr_absorptiondur" style="width: 23px;"></div>

<div class="drisk">
      <input type="text" name="attr_drisk" min="0" style="width: 36px;"></div>

 <div class="magicsoak">
      <input type="radio" name="attr_resistradio" value="0" checked/>Normal&nbsp;&nbsp;
      <input type="radio" name="attr_resistradio" value="1"/>Magic&nbsp;&nbsp;
      <input type="radio" name="attr_resistradio" value="2"/>Evrmt.</div>

  <div class="stamtax">
      <input type="text" name="attr_stamtax" min="0" style="width: 33px;" readonly></div>
  <div class="offbal">
      <input type="text" name="attr_offbal" min="0" max="3" style="width: 33px;"></div>
  <div class="dot1">
      <input type="text" name="attr_dot1" min="0" style="width: 33px;"></div> 
  <div class="dot2">
      <input type="text" name="attr_dot2" min="0" style="width: 33px;"></div> 
  <div class="dot3">
      <input type="text" name="attr_dot3" min="0" style="width: 33px;"></div>
  <div class="paral">
      <input type="text" name="attr_paral" min="0" max="20" style="width: 43px;"></div> 
  <div class="se1">
      <input type="text" name="attr_se1" min="0" max="30" style="width: 33px;"></div> 
  <div class="se2">
      <input type="text" name="attr_se2" min="0" max="30" style="width: 33px;"></div> 
  <div class="se3">
      <input type="text" name="attr_se3" min="0" max="30" style="width: 33px;"></div> 


  <div class="heart">
      <input type="text" name="attr_heart" min="0" style="width: 46px; font-size:30px;"></div>
  <div class="heartmax">
      <input type="text" name="attr_heartmax" min="0" style="width: 25px;"></div>
  <div class="hearttemp">
      <input type="text" name="attr_hearttemp" min="0" style="width: 25px;"></div> 
  <div class="soul">
      <input type="text" name="attr_soul" min="0" style="width: 46px; font-size:30px;"></div> 
  <div class="soulmax">
      <input type="text" name="attr_soulmax" min="0" style="width: 25px;"></div>
  <div class="soultemp">
      <input type="text" name="attr_soultemp" min="0" style="width: 25px;"></div> 
  <div class="stam">
      <input type="text" name="attr_stam" min="0" style="width: 46px; font-size:30px;"></div>
  <div class="stammax">
      <input type="text" name="attr_stammax" min="0" style="width: 25px;"></div>
  <div class="stamtemp">
      <input type="text" name="attr_stamtemp" min="0" style="width: 25px;"></div> 


  <div class="cust1">
      <input type="text" name="attr_cust1" min="0" style="width: 46px; font-size:30px;"></div> 
  <div class="cust2">
      <input type="text" name="attr_cust2" min="0" style="width: 46px; font-size:30px;"></div> 
  <div class="cust3">
      <input type="text" name="attr_cust3" min="0" style="width: 46px; font-size:30px;"></div>
  <div class="custtext1">
      <input type="text" name="attr_custtext1" style="width: 93px;"></div>
  <div class="custtext2">
      <input type="text" name="attr_custtext2" style="width: 93px;"></div>
  <div class="custtext3">
      <input type="text" name="attr_custtext3" style="width: 94px;"></div>
  <div class="cust1max">
      <input type="text" name="attr_cust1max" min="0" style="width: 25px;"></div>
  <div class="cust1temp">
      <input type="text" name="attr_cust1temp" min="0" style="width: 25px;"></div> 
  <div class="cust2max">
      <input type="text" name="attr_cust2max" min="0" style="width: 25px;"></div>
  <div class="cust2temp">
      <input type="text" name="attr_cust2temp" min="0" style="width: 25px;"></div> 
  <div class="cust3max">
      <input type="text" name="attr_cust3max" min="0" style="width: 25px;"></div>
  <div class="cust3temp">
      <input type="text" name="attr_cust3temp" min="0" style="width: 25px;"></div> 

  <div class="cute">
      <input type="text" name="attr_cute" min="0" style="width: 33px;"></div>
  <div class="spook">
      <input type="text" name="attr_spook" min="0" style="width: 33px;"></div>
  <div class="belt">
      <input type="text" name="attr_belt" min="0" style="width: 33px;" readonly></div>
  <div class="speedmax">
      <input type="text" name="attr_speedmax" min="0" style="width: 33px;"></div>
  <div class="speed">
      <input type="text" name="attr_speed" min="0" style="width: 46px; font-size:30px;"></div>
  <div class="footwork">
      <input type="text" name="attr_footwork" min="0" style="width: 33px;" readonly></div>
  <div class="bellymax">
      <input type="text" name="attr_bellymax" min="0" style="width: 33px;"></div>
  <div class="belly">
      <input type="text" name="attr_belly" min="0" style="width: 46px; font-size:30px;"></div>

<div class="init">
    <button type="action" name="act_init">Initative</button></div>

<div class="turn">
    <button type="action" name="act_turn">Start Turn</button></div>
    
<div class="endturn">
    <button type="action" name="act_endturn">End Turn</button></div>

<div class="grapple">
      <button type="action" name="act_grapple">Grapple!</button></div>

<div class="attack">
      <button type="action" name="act_attack">Attack!</button></div>

<div class="parry">
      <button type="action" name="act_parry">Parry!</button></div>
<div class="parrytotal">
    <input type="text" name="attr_parrytotal" min="0" style="width: 43px;" readonly></div>

<div class="dodge">
      <button type="action" name="act_dodge">Dodge!</button></div>
<div class="dodgetotal">
    <input type="text" name="attr_dodgetotal" min="0" style="width: 43px;" readonly></div>
      
<div class="calcdmg">
      <button type="action" name="act_calcdmg">Calculate Damage</button></div>
      
<div class="resist">
      <button type="action" name="act_resist">Resist!</button></div>

</div>
</div>

<rolltemplate class="sheet-rolltemplate-attack">
    <div class="sheet-template-container">
        <h2>Attack Successes</h2>
        <div class="sheet-results">
            <h2>{{computed::rollattack}}</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-grapple">
    <div class="sheet-template-container">
        <h2>Grapple Successes</h2>
        <div class="sheet-results">
            <h2>{{computed::rollgrapple}}</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-dodge">
    <div class="sheet-template-container">
        <h2>Dodge Successes</h2>
        <div class="sheet-results">
            <h2>{{computed::rolldodge}}</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-parry">
    <div class="sheet-template-container">
        <h2>Parry Successes</h2>
        <div class="sheet-results">
            <h2>{{computed::rollparry}}</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-checkmight">
    <div class="sheet-template-container">
        <h2>Might Check Successes</h2>
        <div class="sheet-results">
            <h2>{{mightcheck}}</h2>
        </div>
        <div class="test2">
            <h3>Check Reroll {{mightreroll}}</h3>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-checkinsight">
    <div class="sheet-template-container">
        <h2>Insight Check Successes</h2>
        <div class="sheet-results">
            <h2>{{insightcheck}}</h2>
        </div>
        <div class="test2">
            <h3>Check Reroll {{insightreroll}}</h3>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-checkshell">
    <div class="sheet-template-container">
        <h2>Shell Check Successes</h2>
        <div class="sheet-results">
            <h2>{{shellcheck}}</h2>
        </div>
        <div class="test2">
            <h3>Check Reroll {{shellreroll}}</h3>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-checkgrace">
    <div class="sheet-template-container">
        <h2>Grace Check Successes</h2>
        <div class="sheet-results">
            <h2>{{gracecheck}}</h2>
        </div>
        <div class="test2">
            <h3>Check Reroll {{gracereroll}}</h3>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-checkcute">
    <div class="sheet-template-container">
        <h2>Cute Check Successes</h2>
        <div class="sheet-results">
            <h2>{{cutecheck}}</h2>
        </div>
        <div class="test2">
            <h3>Check Reroll {{cutereroll}}</h3>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-checkspook">
    <div class="sheet-template-container">
        <h2>Spook Check Successes</h2>
        <div class="sheet-results">
            <h2>{{spookcheck}}</h2>
        </div>
        <div class="test2">
            <h3>Check Reroll {{spookreroll}}</h3>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-init">
    <div class="sheet-template-container">
        <h2>Initiative</h2>
        <div class="sheet-results">
            <h2>{{rollinit}}</h2>
        <div class="test2">
            <h3>init. Reroll {{computed::rollinitreroll}}</h3>
        </div>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-damage">
    <div class="sheet-template-container">
        <h2>Damage Risk</h2>
        <div class="sheet-results">
            <h2>{{rolldamage}}</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-soak">
    <div class="sheet-template-container">
        <h2>Final Damage</h2>
        <div class="sheet-results">
            <h2>{{computed::rollsoak}}</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-error">
    <div class="sheet-template-container">
        <h2>Error!</h2>
        <div class="sheet-results">
            <h2>Not enough stamina!</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-errordrisk">
    <div class="sheet-template-container">
        <h2>Error!</h2>
        <div class="sheet-results">
            <h2>No damage risk!</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-errorhit">
    <div class="sheet-template-container">
        <h2>Error!</h2>
        <div class="sheet-results">
            <h2>No final hits!</h2>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-errorload">
    <div class="sheet-template-container">
        <h2>This is a Public Shaming!</h2>
        <div class="sheet-results">
            <h3>You exceeded double your Load!!!</h3>
        </div>
    </div>
</rolltemplate>

<script type="text/worker">

    on('clicked:attack', (info) => {
          getAttrs(["result","resultreroll","dedsta","stam","stamtemp","atkboxpaired","atkboxopportunity","stamtax","stamtaxtax","stamattackmod","setsuccessattack","wpntype"], function(values) {
        let atkboxopportunity = parseInt(values.atkboxopportunity)||0;
        let wpntype = parseInt(values.wpntype)||0;
        let dedsta = parseInt(values.dedsta)||0;
        let stamattackmod = parseInt(values.stamattackmod)||0;
        let stam = parseInt(values.stam)||0;
        let stamtemp = parseInt(values.stamtemp)||0;
        let stamtx = parseInt(values.stamtax)||0;
        let stamtaxmod = parseInt(values.stamtaxtax)||0;
        let stamtax = (atkboxopportunity == 0) ? stamtaxmod + stamtx : 0;
        let paired = parseInt(values.atkboxpaired)||0;
        let stamtotal = stam + stamtemp;
        let spentstam = dedsta + 1 + stamtax + stamattackmod - paired;
        if(spentstam <= stamtotal) {
            let rollString = "&{template:attack} {{name=Attack}} {{rollattack=[[[[floor(@{result})]]d6s>@{setsuccessattack}]]}}";
            if(values.resultreroll >= "1") {
                rollString += "{{rollattackr1=[[@{resultreroll}d6>@{setsuccessattack}]]}}";
            } else {
            // this else branch is just to make the later code easier. In your roll temmplate you'd only display it if it has a value > 0
                rollString += "{{rollattackr1=[[0]]}}";
            }
            startRoll(rollString, results => {
                const result = parseInt(values.result)||0;
                const roll = results.results.rollattack.result;
                const reroll_calculated = results.results.rollattackr1.result;
                const rerollmin = (result - roll <= 0) ? 0 : result - roll;
                const reroll = (rerollmin - reroll_calculated <= 0) ? rerollmin : reroll_calculated;
                const total = roll + reroll;
            finishRoll(results.rollId, {
                rollattack: total
            });
            });
        setAttrs({
            "atkboxgrapple": 0
        });
        setAttrs({
            "atkboxsqueeze": 0
        });
        setAttrs({
            "atkboxpaired": 0
        });
        setAttrs({
            "atkboxunseen": 0
        });
        setAttrs({
            "atkboxcovered": 0
        });
        if((stamtemp > "0") && (spentstam > stam)){
            let stammath = spentstam - stam;
            setAttrs({                            
                "stam": 0
            });
            setAttrs({
                "stamtemp": stamtemp - stammath
            });    
        }
        else {
            setAttrs({                            
                "stam": stam - spentstam
            });  
        }
        setAttrs({
            "dedstafloating": dedsta
        });
        setAttrs({
            "wpntypefloating": wpntype
        });
        setAttrs({
            "dedsta": 0
        });
        setAttrs({
            "stamtax": stamtax + 1
        });
        setAttrs({
            "stamtaxnebulous": stamtax + 1
        });
        }
    else {
        let rollString = "&{template:error} {{name=Error}} {{rollerror=[[0]]}}";
        startRoll(rollString, results => {
            finishRoll(results.rollId, {
                });
        });
    }
    });
});

    on('clicked:grapple', (info) => {
          getAttrs(["grapplefinal","resultrerollgrapple","dedsta","stam","stamtemp","atkboxpaired","atkboxopportunity","stamtax","stamtaxtax","grappletoggle","stamgrapplemod","setsuccessattack"], function(values) {
        let atkboxopportunity = parseInt(values.atkboxopportunity)||0;
        let grappletoggle = parseInt(values.grappletoggle)||0;
        let stamgrapplemod = parseInt(values.stamgrapplemod)||0;
        let dedsta = parseInt(values.dedsta)||0;
        let stam = parseInt(values.stam)||0;
        let stamtemp = parseInt(values.stamtemp)||0;
        let stamtx = parseInt(values.stamtax)||0;
        let stamtaxmod = parseInt(values.stamtaxtax)||0;
        let stamtax = (atkboxopportunity == 0) ? stamtaxmod + stamtx : 0;
        let paired = parseInt(values.atkboxpaired)||0;
        let stamtotal = stam + stamtemp;
        let spentstam = (grappletoggle == 1) ? dedsta + 1 + stamtax + stamgrapplemod - paired : dedsta;
        if(spentstam <= stamtotal && grappletoggle == "1") {
            let rollString = "&{template:grapple} {{name=Grapple}} {{rollgrapple=[[[[floor(@{grapplefinal})]]d6s>@{setsuccessattack}]]}}";
            if(values.resultrerollgrapple >= "1") {
                rollString += "{{rollgrappler1=[[@{resultrerollgrapple}d6>@{setsuccessattack}]]}}";
            } else {
            // this else branch is just to make the later code easier. In your roll temmplate you'd only display it if it has a value > 0
                rollString += "{{rollgrappler1=[[0]]}}";
            }
            startRoll(rollString, results => {
                const result = parseInt(values.grapplefinal)||0;
                const roll = results.results.rollgrapple.result;
                const reroll_calculated = results.results.rollgrappler1.result;
                const rerollmin = (result - roll <= 0) ? 0 : result - roll;
                const reroll = (rerollmin - reroll_calculated <= 0) ? rerollmin : reroll_calculated;
                const total = roll + reroll;
            finishRoll(results.rollId, {
                rollgrapple: total
            });
            });
        setAttrs({
            "atkboxgrapple": 0
        });
        setAttrs({
            "atkboxsqueeze": 0
        });
        setAttrs({
            "atkboxpaired": 0
        });
        setAttrs({
            "atkboxunseen": 0
        });
        setAttrs({
            "atkboxcovered": 0
        });
        if((stamtemp > "0") && (spentstam > stam)){
            let stammath = spentstam - stam;
            setAttrs({                            
                "stam": 0
            });
            setAttrs({
                "stamtemp": stamtemp - stammath
            });    
        }
        else {
            setAttrs({                            
                "stam": stam - spentstam
            });  
        }
        setAttrs({
            "dedsta": 0
        });
        setAttrs({
            "stamtax": stamtax + 1
        });
        setAttrs({
            "stamtaxnebulous": stamtax + 1
        });
        }
    if (spentstam <= stamtotal && grappletoggle == "2") {
            let rollString = "&{template:grapple} {{name=Grapple}} {{rollgrapple=[[[[floor(@{grapplefinal})]]d6s>@{setsuccessattack}]]}}";
            if(values.resultrerollgrapple >= "1") {
                rollString += "{{rollgrappler1=[[@{resultrerollgrapple}d6>@{setsuccessattack}]]}}";
            } else {
            // this else branch is just to make the later code easier. In your roll temmplate you'd only display it if it has a value > 0
                rollString += "{{rollgrappler1=[[0]]}}";
            }
            startRoll(rollString, results => {
                const result = parseInt(values.grapplefinal)||0;
                const roll = results.results.rollgrapple.result;
                const reroll_calculated = results.results.rollgrappler1.result;
                const rerollmin = (result - roll <= 0) ? 0 : result - roll;
                const reroll = (rerollmin - reroll_calculated <= 0) ? rerollmin : reroll_calculated;
                const total = roll + reroll;
            finishRoll(results.rollId, {
                rollgrapple: total
            });
            });
        if((stamtemp > "0") && (spentstam > stam)){
            let stammath = spentstam - stam;
            setAttrs({                            
                "stam": 0
            });
            setAttrs({
                "stamtemp": stamtemp - stammath
            });    
        }
        else {
            setAttrs({                            
                "stam": stam - spentstam
            });  
        }
        setAttrs({
            "dedsta": 0
        });
    }
    if(spentstam > stamtotal) {
        let rollString = "&{template:error} {{name=Error}} {{rollerror=[[0]]}}";
        startRoll(rollString, results => {
            finishRoll(results.rollId, {
                });
        });
    }
    });
});

    on('clicked:dodge', (info) => {
          getAttrs(["dodgetotal","gracereroll","dedsta","stam","stamtemp","offbal","defboxmove","bulkcheck","stamdodgemod","setsuccessdodge","dodgereroll"], function(values) {
        let dedsta = parseInt(values.dedsta)||0;
        let stamdodgemod = parseInt(values.stamdodgemod)||0;
        let stam = parseInt(values.stam)||0;
        let stamtemp = parseInt(values.stamtemp)||0;
        let offbal = parseInt(values.offbal)||0;
        let defboxmove = parseInt(values.defboxmove)||0;
        let bulkcheck = parseInt(values.bulkcheck)||0;
        let stamtotal = stam + stamtemp;
        let spentstam = dedsta + 1 + bulkcheck + stamdodgemod;
        if(spentstam <= stamtotal) {
            let rollString = "&{template:dodge} {{name=Dodge}} {{rolldodge=[[[[floor(@{dodgetotal})]]d6s>@{setsuccessdodge}]]}}";
            if(values.dodgereroll >= "1") {
                rollString += "{{rolldodger1=[[@{dodgereroll}d6>@{setsuccessdodge}]]}}";
            } else {
            // this else branch is just to make the later code easier. In your roll temmplate you'd only display it if it has a value > 0
                rollString += "{{rolldodger1=[[0]]}}";
            }
            startRoll(rollString, results => {
            const dodgetotal = parseInt(values.dodgetotal)||0;
            const roll = results.results.rolldodge.result;
            const reroll_calculated = results.results.rolldodger1.result;
            const rerollmin = (dodgetotal - roll <= 0) ? 0 : dodgetotal - roll;
            const reroll = (rerollmin - reroll_calculated <= 0) ? rerollmin : reroll_calculated;
            const total = roll + reroll;
            finishRoll(results.rollId, {
                rolldodge: total
                });
        });
        if(defboxmove == "1") {
            setAttrs({                            
                "offbal": offbal + 1
            });
        }
        setAttrs({
            "defboxgrapple": 0
        });
        setAttrs({
            "defboxsqueeze": 0
        });
        setAttrs({
            "defboxunseen": 0
        });
        setAttrs({
            "defboxmove": 0
        });
        setAttrs({
            "defboxbulk": 0
        });
        if((stamtemp > "0") && (spentstam > stam)){
            let stammath = spentstam - stam;
            setAttrs({                            
                "stam": 0
            });
            setAttrs({
                "stamtemp": stamtemp - stammath
            });    
        }
        else {
            setAttrs({                            
                "stam": stam - spentstam
            });  
        }
        setAttrs({
            "dedsta": 0
        });
        }
        else {
        let rollString = "&{template:error} {{name=Error}} {{rollerror=[[0]]}}";
        startRoll(rollString, results => {
            finishRoll(results.rollId, {
                });
            });
        }
    });
});

on("change:gracereroll change:dodgererollbuff sheet:opened", function() {  
  getAttrs(["gracereroll","dodgererollbuff"], function(values) {
    let gracereroll = parseFloat(values.gracereroll)||0;
    let dodgererollbuff = parseInt(values.dodgererollbuff)||0;
    setAttrs({
        "dodgereroll": gracereroll + dodgererollbuff
    });
  });
});

    on('clicked:parry', (info) => {
          getAttrs(["parrytotal","mightreroll","dedsta","stam","stamtemp","bulkcheck","stamparrymod","setsuccessparry","parryreroll"], function(values) {
        let dedsta = parseInt(values.dedsta)||0;
        let stamparrymod = parseInt(values.stamparrymod)||0;
        let stam = parseInt(values.stam)||0;
        let stamtemp = parseInt(values.stamtemp)||0;
        let bulkcheck = parseInt(values.bulkcheck)||0;
        let stamtotal = stam + stamtemp;
        let spentstam = dedsta + 1 + bulkcheck + stamparrymod;
        if(spentstam <= stamtotal) {
            let rollString = "&{template:parry} {{name=Parry}} {{rollparry=[[[[floor(@{parrytotal})]]d6s>@{setsuccessparry}]]}}";
            if(values.parryreroll >= "1") {
                rollString += "{{rollparryr1=[[@{parryreroll}d6>@{setsuccessparry}]]}}";
            } else {
            // this else branch is just to make the later code easier. In your roll temmplate you'd only display it if it has a value > 0
                rollString += "{{rollparryr1=[[0]]}}";
            }
            startRoll(rollString, results => {
            const parrytotal = parseInt(values.parrytotal)||0;
            const roll = results.results.rollparry.result;
            const reroll_calculated = results.results.rollparryr1.result;
            const rerollmin = (parrytotal - roll <= 0) ? 0 : parrytotal - roll;
            const reroll = (rerollmin - reroll_calculated <= 0) ? rerollmin : reroll_calculated;
            const total = roll + reroll;
            finishRoll(results.rollId, {
                rollparry: total
                });
        });
        setAttrs({
            "defboxgrapple": 0
        });
        setAttrs({
            "defboxsqueeze": 0
        });
        setAttrs({
            "defboxunseen": 0
        });
        setAttrs({
            "defboxranged": 0
        });
        if((stamtemp > "0") && (spentstam > stam)){
            let stammath = spentstam - stam;
            setAttrs({                            
                "stam": 0
            });
            setAttrs({
                "stamtemp": stamtemp - stammath
            });    
        }
        else {
            setAttrs({                            
                "stam": stam - spentstam
            });  
        }
        setAttrs({
            "dedsta": 0
        });
        }
        else {
        let rollString = "&{template:error} {{name=Error}} {{rollerror=[[0]]}}";
        startRoll(rollString, results => {
            finishRoll(results.rollId, {
                });
            });
        }
    });
});

on("change:mightreroll change:parryrerollbuff change:parrytype change:parryweaponrerollbuff change:parryshieldrerollbuff sheet:opened", function() {  
  getAttrs(["mightreroll","parryrerollbuff","parrytype","parryweaponrerollbuff","parryshieldrerollbuff"], function(values) {
    let mightreroll = parseFloat(values.mightreroll)||0;
    let parryrerollbuff = parseInt(values.parryrerollbuff)||0;
    let parrytype = parseInt(values.parrytype)||0;
    let parryweaponrerollbuff = parseInt(values.parryweaponrerollbuff)||0;
    let parryshieldrerollbuff = parseInt(values.parryshieldrerollbuff)||0;
    let parryrerollequipbuff = (parrytype == "1") ? parryweaponrerollbuff : parryshieldrerollbuff;
    setAttrs({
        "parryreroll": mightreroll + parryrerollbuff + parryrerollequipbuff
    });
  });
});

on("change:grapplefinal change:grapplererollmod sheet:opened", function() {  
  getAttrs(["grapplefinal","grapplererollmod"], function(values) {
    let recheck = parseFloat(values.grapplefinal)||0;
    let grapplererollmod = parseInt(values.grapplererollmod)||0;
    let resultreroll = recheck - Math.floor(recheck);
    if(resultreroll == "0") {
        setAttrs({
            "resultrerollgrapple": 0 + grapplererollmod
        });}
    if(resultreroll == "0.5") {
        setAttrs({
            "resultrerollgrapple": 1 + grapplererollmod
    });}
  });
});

on("change:dmgboxhit sheet:opened", function() {  
  getAttrs(["dmgboxhit","dmgcrt","dedstafloating","wpntypefloating","shieldbashcrt"], function(values) {
    let dmgboxhit = parseInt(values.dmgboxhit)||0;
    let dmgcrt = parseInt(values.dmgcrt)||0;
    let dedsta = parseInt(values.dedstafloating)||0;
    let wpntype = parseInt(values.wpntypefloating)||0;
    let shieldbashcrt = parseInt(values.shieldbashcrt)||0;
    let rollovercap = (dedsta >= dmgcrt) ? dedsta : dmgcrt;
    let rollover = dmgboxhit - 1;
    let damageriskwpn = ((rollovercap >= rollover) && (dmgboxhit != 0)) ? rollover + dmgcrt : dmgcrt + rollovercap;
    let damageriskshield1 = ((rollovercap >= rollover) && (dmgboxhit != 0)) ? rollover + dmgcrt : dmgcrt + rollovercap;
    let damageriskshield2 = (shieldbashcrt == 0) ? dmgcrt : damageriskshield1;
    let damageriskz = (dmgboxhit == 0) ? 0 : 1;
    let damagerisk = (wpntype == 1) ? damageriskwpn : damageriskshield2;
    setAttrs({
        "damageriskz": damageriskz
    });
    setAttrs({
        "damagerisk": damagerisk
    });
  });
});

    on('clicked:calcdmg', (info) => {
          getAttrs(["damagerisk","damageriskz"], function(values) {
              let damagerisk = parseInt(values.damagerisk)||0;
              let damageriskz = parseInt(values.damageriskz)||0;
            if(damageriskz != "0") {
            let rollString = "&{template:damage} {{name=Risk}} {{rolldamage=[[@{damagerisk}]]}}";
            startRoll(rollString, results => {
            finishRoll(results.rollId, {
            });
        });
            }
            else {
        let rollString = "&{template:errorhit} {{name=Error}} {{rollerrorhit=[[0]]}}";
        startRoll(rollString, results => {
            finishRoll(results.rollId, {
                });
            });
        }
        setAttrs({
            "dmgboxhit": 0
        });
    });
});

on("change:initmod change:gracetotal sheet:opened", function() {  
  getAttrs(["gracetotal","initmod"], function(values) {
    let gracetotal = parseInt(values.gracetotal)||0;
    let initmod = parseInt(values.initmod)||0;
    setAttrs({
        "inittotal": initmod + gracetotal
    });
  });
});

    on('clicked:init', (info) => {
          getAttrs(["inittotal","initreroll","gracereroll"], function(values) {
            let rollString = "&{template:init} {{name=Test}} {{rollinit=[[[[@{inittotal}]]d6s &{tracker}]]}}";
            if(values.initreroll >= "1") {
                rollString += "{{rollinitreroll=[[@{initreroll}d6]]}}";
            } else {
            // this else branch is just to make the later code easier. In your roll temmplate you'd only display it if it has a value > 0
                rollString += "{{rollinitreroll=[[0]]}}";
            }
            startRoll(rollString, results => {
            finishRoll(results.rollId, {
                rollinitreroll: reroll
                });
        });
    });
});

on("change:gracereroll change:initrerollmod sheet:opened", function() {  
  getAttrs(["gracereroll","initrerollmod"], function(values) {
    let recheck = parseFloat(values.gracereroll)||0;
    let initrerollmod = parseInt(values.initrerollmod)||0;
    setAttrs({
        "initreroll": recheck + initrerollmod
    });
  });
});

on("change:gracereroll change:initrerollmod sheet:opened", function() {  
  getAttrs(["gracereroll","initrerollmod"], function(values) {
    let recheck = parseFloat(values.gracereroll)||0;
    let initrerollmod = parseInt(values.initrerollmod)||0;
    setAttrs({
        "initreroll": recheck + initrerollmod
    });
  });
});

</script>

<script type="text/worker">

on("change:toggle change:mighttotalfloat change:gracetotalfloat change:insighttotalfloat change:meleeradio change:rangedradio change:mightattackmod change:graceattackmod change:insightattackmod change:mightattackrerollmod change:graceattackrerollmod change:insightattackrerollmod change:mightreroll change:gracereroll change:insightreroll sheet:opened", function() {  
  getAttrs(["mighttotalfloat","gracetotalfloat","insighttotalfloat","toggle","meleeradio","rangedradio","mightattackmod","graceattackmod","insightattackmod","mightattackrerollmod","graceattackrerollmod","insightattackrerollmod","mightreroll","gracereroll","insightreroll"], function(values) {
    let mighttotalfloat = parseFloat(values.mighttotalfloat)||0;
    let mightattackmod = parseInt(values.mightattackmod)||0;
    let mightattackrerollmod = parseInt(values.mightattackrerollmod)||0;
    let mightreroll = parseInt(values.mightreroll)||0;
    let gracetotalfloat = parseFloat(values.gracetotalfloat)||0;
    let graceattackmod = parseInt(values.graceattackmod)||0;
    let graceattackrerollmod = parseInt(values.graceattackrerollmod)||0;
    let gracereroll = parseInt(values.gracereroll)||0;
    let insighttotalfloat = parseFloat(values.insighttotalfloat)||0;
    let insightattackmod = parseInt(values.insightattackmod)||0;
    let insightattackrerollmod = parseInt(values.insightattackrerollmod)||0;
    let insightreroll = parseInt(values.insightreroll)||0;
    let toggle = parseInt(values.toggle)||0;
    let meleeradio = parseInt(values.meleeradio)||0;
    let rangedradio = parseInt(values.rangedradio)||0;
    if (meleeradio == "1") {
        setAttrs({
            "meleetotal": mighttotalfloat + mightattackmod
        });
        setAttrs({
            "meleererolltotal": mightattackrerollmod + mightreroll
        });
    }
    if (meleeradio == "2") {
        setAttrs({
            "meleetotal": gracetotalfloat + graceattackmod
        });
        setAttrs({
            "meleererolltotal": graceattackrerollmod + gracereroll
        });
    }
    if (meleeradio == "3") {
        setAttrs({
            "meleetotal": insighttotalfloat + insightattackmod
        });
        setAttrs({
            "meleererolltotal": insightattackrerollmod + insightreroll
        });
    }
    if (rangedradio == "1") {
        setAttrs({
            "rangedtotal": mighttotalfloat + mightattackmod
        });
        setAttrs({
            "rangedrerolltotal": mightattackrerollmod + mightreroll
        });
    }
    if (rangedradio == "2") {
        setAttrs({
            "rangedtotal": gracetotalfloat + graceattackmod
        });
        setAttrs({
            "rangedrerolltotal": graceattackrerollmod + gracereroll
        });
    }
    if (rangedradio == "3") {
        setAttrs({
            "rangedtotal": insighttotalfloat + insightattackmod
        });
        setAttrs({
            "rangedrerolltotal": insightattackrerollmod + insightreroll
        });
    }
  });
});

on("change:toggle change:meleetotal change:rangedtotal sheet:opened", function() {  
  getAttrs(["toggle","meleetotal","rangedtotal"], function(values) {
    let toggle = parseInt(values.toggle)||0;
    let meleetotal = parseFloat(values.meleetotal)||0;
    let rangedtotal = parseFloat(values.rangedtotal)||0;
    const output = {};
    output.mg = (toggle == "1") ? meleetotal : rangedtotal;
    setAttrs(output);
  });
});

</script>

<script type="text/worker">

on("change:mg change:qty1 change:bulk1 change:rng1 change:dmg1 change:resultmod change:dedsta change:result1zero change:paraltier change:gplequip change:grapplerollmod change:grapplearms change:grappletoggle change:shieldbashradio1 change:wpntype1 change:shieldqtybonus1 sheet:opened", function() {  
  getAttrs(["qty1","mg","resultmod","dedsta","result1zero","paraltier","gplequip","mighttotalfloat","grapplerollmod","grapplearms","grappletoggle","shieldbashradio1","wpntype1","shieldqtybonus1"], function(values) {
    let shieldbashradio = parseInt(values.shieldbashradio1)||0;
    let shieldqtybonus = parseInt(values.shieldqtybonus1)||0;
    let wpntype = parseInt(values.wpntype1)||0;
    let mighttotalfloat = parseFloat(values.mighttotalfloat)||0;
    let mg = parseFloat(values.mg)||0;
    let qty1 = parseFloat(values.qty1)||0;
    let resultmod = parseInt(values.resultmod)||0;
    let dedsta = parseInt(values.dedsta)||0;
    let paraltier = parseInt(values.paraltier)||0;
    let paraldebuff = (paraltier >= 2) ? 1 : 0;
    let mindice = mg + qty1 + 1 + dedsta - resultmod - paraldebuff;
    let mindiceshield = (shieldbashradio == 0) ? mighttotalfloat + 1 + dedsta - resultmod - paraldebuff : mighttotalfloat + shieldqtybonus + 1 + 1 + dedsta - resultmod - paraldebuff;
    let gplequip = parseFloat(values.gplequip)||0;
    let grapplearms = parseInt(values.grapplearms)||0;
    let grapplerollmod = parseInt(values.grapplerollmod)||0;
    let grappletoggle = parseInt(values.grappletoggle)||0;
    let grappleval = (gplequip == 1) ? 1 : 0;
    let grappledice = (grappletoggle == 1) ? (mindice + mighttotalfloat + grapplerollmod + grapplearms - mg) : (mindice + mighttotalfloat + grapplerollmod + grapplearms + resultmod - mg - qty1 - 1);
    if (wpntype == "1") {
        setAttrs({
        "result1": mindice
        });
    }
    if (wpntype == "2") {
        setAttrs({
        "result1": mindiceshield
        });
    }
    if(values.result1zero == "0") {
        setAttrs({
            "result1": 0
        });}
        if(grappleval == "1") {
        setAttrs({
            "grapplefinal": grappledice
        });}
  });
});

</script>

<script type="text/worker">

on("change:mg change:qty2 change:bulk2 change:rng2 change:dmg2 change:resultmod change:dedsta change:result2zero change:paraltier change:gplequip change:grapplerollmod change:grapplearms change:grappletoggle change:shieldbashradio2 change:wpntype2 change:shieldqtybonus2 sheet:opened", function() {  
  getAttrs(["qty2","mg","resultmod","dedsta","result2zero","paraltier","gplequip","mighttotalfloat","grapplerollmod","grapplearms","grappletoggle","shieldbashradio2","wpntype2","shieldqtybonus2"], function(values) {
    let shieldbashradio = parseInt(values.shieldbashradio2)||0;  
    let shieldqtybonus = parseInt(values.shieldqtybonus2)||0;
    let wpntype = parseInt(values.wpntype2)||0;
    let mighttotalfloat = parseFloat(values.mighttotalfloat)||0;
    let mg = parseFloat(values.mg)||0;
    let qty2 = parseFloat(values.qty2)||0;
    let resultmod = parseInt(values.resultmod)||0;
    let dedsta = parseInt(values.dedsta)||0;
    let paraltier = parseInt(values.paraltier)||0;
    let paraldebuff = (paraltier >= 2) ? 1 : 0;
    let mindice = mg + qty2 + 1 + dedsta - resultmod - paraldebuff;
    let mindiceshield = (shieldbashradio == 0) ? mighttotalfloat + 1 + dedsta - resultmod - paraldebuff : mighttotalfloat + shieldqtybonus + 1 + 1 + dedsta - resultmod - paraldebuff;
    let gplequip = parseFloat(values.gplequip)||0;
    let grapplearms = parseInt(values.grapplearms)||0;
    let grapplerollmod = parseInt(values.grapplerollmod)||0;    
    let grappletoggle = parseInt(values.grappletoggle)||0;
    let grappleval = (gplequip == 2) ? 1 : 0;
    let grappledice = (grappletoggle == 1) ? (mindice + mighttotalfloat + grapplerollmod + grapplearms - mg) : (mindice + mighttotalfloat + grapplerollmod + grapplearms + resultmod - mg - qty2 - 1);
    if (wpntype == "1") {
        setAttrs({                            
        "result2": mindice
        });
    }
    if (wpntype == "2") {
        setAttrs({                            
        "result2": mindiceshield
        });
    }
        if(values.result2zero == "0") {
        setAttrs({
            "result2": 0
        });}
        if(grappleval == "1") {
        setAttrs({
            "grapplefinal": grappledice
        });}
  });
});

on("change:mg change:qty3 change:bulk3 change:rng3 change:dmg3 change:resultmod change:dedsta change:result3zero change:paraltier change:gplequip change:grapplerollmod change:grapplearms change:grappletoggle change:shieldbashradio3 change:wpntype3 change:shieldqtybonus3 sheet:opened", function() {  
  getAttrs(["qty3","mg","resultmod","dedsta","result3zero","paraltier","gplequip","mighttotalfloat","grapplerollmod","grapplearms","grappletoggle","shieldbashradio3","wpntype3","shieldqtybonus3"], function(values) {
    let shieldbashradio = parseInt(values.shieldbashradio3)||0;
    let shieldqtybonus = parseInt(values.shieldqtybonus3)||0;
    let wpntype = parseInt(values.wpntype3)||0;
    let mighttotalfloat = parseFloat(values.mighttotalfloat)||0;
    let mg = parseFloat(values.mg)||0;
    let qty3 = parseFloat(values.qty3)||0;
    let resultmod = parseInt(values.resultmod)||0;
    let dedsta = parseInt(values.dedsta)||0;
    let paraltier = parseInt(values.paraltier)||0;
    let paraldebuff = (paraltier >= 2) ? 1 : 0;
    let mindice = mg + qty3 + 1 + dedsta - resultmod - paraldebuff;
    let mindiceshield = (shieldbashradio == 0) ? mighttotalfloat + 1 + dedsta - resultmod - paraldebuff : mighttotalfloat + shieldqtybonus + 1 + 1 + dedsta - resultmod - paraldebuff;
    let gplequip = parseFloat(values.gplequip)||0;
    let grapplearms = parseInt(values.grapplearms)||0;
    let grapplerollmod = parseInt(values.grapplerollmod)||0;    
    let grappletoggle = parseInt(values.grappletoggle)||0;
    let grappleval = (gplequip == 3) ? 1 : 0;
    let grappledice = (grappletoggle == 1) ? mindice + mighttotalfloat + grapplerollmod + grapplearms - mg : mindice + mighttotalfloat + grapplerollmod + grapplearms + resultmod - mg - qty3 - 1;
    if (wpntype == "1") {
        setAttrs({                            
        "result3": mindice
        });
    }
    if (wpntype == "2") {
        setAttrs({                            
        "result3": mindiceshield
        });
    }
        if(values.result3zero == "0") {
        setAttrs({
            "result3": 0
        });}
        if(grappleval == "1") {
        setAttrs({
            "grapplefinal": grappledice
        });}
  });
});

on("change:mg change:qty4 change:bulk4 change:rng4 change:dmg4 change:resultmod change:dedsta change:result4zero change:paraltier change:gplequip change:grapplerollmod change:grapplearms change:grappletoggle change:shieldbashradio4 change:wpntype4 change:shieldqtybonus4 sheet:opened", function() {  
  getAttrs(["qty4","mg","resultmod","dedsta","result4zero","paraltier","gplequip","mighttotalfloat","grapplerollmod","grapplearms","grappletoggle","shieldbashradio4","wpntype4","shieldqtybonus4"], function(values) {
    let shieldbashradio = parseInt(values.shieldbashradio4)||0;
    let shieldqtybonus = parseInt(values.shieldqtybonus4)||0;
    let wpntype = parseInt(values.wpntype4)||0;
    let mighttotalfloat = parseFloat(values.mighttotalfloat)||0;
    let mg = parseFloat(values.mg)||0;
    let qty4 = parseFloat(values.qty4)||0;
    let resultmod = parseInt(values.resultmod)||0;
    let dedsta = parseInt(values.dedsta)||0;
    let paraltier = parseInt(values.paraltier)||0;
    let paraldebuff = (paraltier >= 2) ? 1 : 0;
    let mindice = mg + qty4 + 1 + dedsta - resultmod - paraldebuff;
    let mindiceshield = (shieldbashradio == 0) ? mighttotalfloat + 1 + dedsta - resultmod - paraldebuff : mighttotalfloat + shieldqtybonus + 1 + 1 + dedsta - resultmod - paraldebuff;
    let gplequip = parseFloat(values.gplequip)||0;
    let grapplearms = parseInt(values.grapplearms)||0;
    let grapplerollmod = parseInt(values.grapplerollmod)||0;    
    let grappletoggle = parseInt(values.grappletoggle)||0;
    let grappleval = (gplequip == 4) ? 1 : 0;
    let grappledice = (grappletoggle == 1) ? mindice + mighttotalfloat + grapplerollmod + grapplearms - mg : mindice + mighttotalfloat + grapplerollmod + grapplearms + resultmod - mg - qty4 - 1;
    if (wpntype == "1") {
        setAttrs({                            
        "result4": mindice
        });
    }
    if (wpntype == "2") {
        setAttrs({                            
        "result4": mindiceshield
        });
    }
        if(values.result4zero == "0") {
        setAttrs({
            "result4": 0
        });}
        if(grappleval == "1") {
        setAttrs({
            "grapplefinal": grappledice
        });}
  });
});

</script>

<script type="text/worker">

on("change:mg change:qty5 change:bulk5 change:rng5 change:dmg5 change:resultmod change:dedsta change:result5zero change:paraltier change:gplequip change:grapplerollmod change:grapplearms change:grappletoggle change:shieldbashradio5 change:wpntype5 change:shieldqtybonus5 sheet:opened", function() {  
  getAttrs(["qty5","mg","resultmod","dedsta","result5zero","paraltier","gplequip","mighttotalfloat","grapplerollmod","grapplearms","grappletoggle","shieldbashradio5","wpntype5","shieldqtybonus5"], function(values) {
    let shieldbashradio = parseInt(values.shieldbashradio5)||0;
    let shieldqtybonus = parseInt(values.shieldqtybonus5)||0;
    let wpntype = parseInt(values.wpntype5)||0;
    let mighttotalfloat = parseFloat(values.mighttotalfloat)||0;
    let mg = parseFloat(values.mg)||0;
    let qty5 = parseFloat(values.qty5)||0;
    let resultmod = parseInt(values.resultmod)||0;
    let dedsta = parseInt(values.dedsta)||0;
    let paraltier = parseInt(values.paraltier)||0;
    let paraldebuff = (paraltier >= 2) ? 1 : 0;
    let mindice = mg + qty5 + 1 + dedsta - resultmod - paraldebuff;
    let mindiceshield = (shieldbashradio == 0) ? mighttotalfloat + 1 + dedsta - resultmod - paraldebuff : mighttotalfloat + shieldqtybonus + 1 + 1 + dedsta - resultmod - paraldebuff;
    let gplequip = parseFloat(values.gplequip)||0;
    let grapplearms = parseInt(values.grapplearms)||0;
    let grapplerollmod = parseInt(values.grapplerollmod)||0;
    let grappletoggle = parseInt(values.grappletoggle)||0;
    let grappleval = (gplequip == 5) ? 1 : 0;
    let grapplemath1 = mindice + mighttotalfloat + grapplerollmod + grapplearms - mg;
    let grapplemath2 = mindice + mighttotalfloat + grapplerollmod + grapplearms + resultmod - mg - qty5 - 1;
    let grappledice = (grappletoggle == 1) ? grapplemath1 : grapplemath2;
    if (wpntype == "1") {
        setAttrs({                            
        "result5": mindice
        });
    }
    if (wpntype == "2") {
        setAttrs({                            
        "result5": mindiceshield
        });
    }
        if(values.result5zero == "0") {
        setAttrs({
            "result5": 0
        });}
        if(grappleval == "1") {
        setAttrs({
            "grapplefinal": grappledice
        });}
  });
});

on("change:result change:attackrerollbuff change:meleererolltotal change:rangedrerolltotal change:toggle sheet:opened", function() {  
  getAttrs(["result","attackrerollbuff","meleererolltotal","rangedrerolltotal","toggle"], function(values) {
    let recheck = parseFloat(values.result)||0;
    let toggle = parseInt(values.toggle)||0;
    let attackrerollbuff = parseInt(values.attackrerollbuff)||0;
    let meleererolltotal = parseInt(values.meleererolltotal)||0;
    let rangedrerolltotal = parseInt(values.rangedrerolltotal)||0;
    let togglereroll = (toggle == "1") ? meleererolltotal : rangedrerolltotal;
    let resultreroll = recheck - Math.floor(recheck);
    setAttrs({
        "resultreroll": attackrerollbuff + togglereroll
    });
  });
});

</script>

<script type="text/worker">

on("change:shieldbashradio1 change:dmg1 change:bulk1 change:wpntype1 sheet:opened", function() {  
  getAttrs(["shieldbashradio1","dmg1","bulk1","wpntype1"], function(values) {
    let shieldbashradio1 = parseFloat(values.shieldbashradio1)||0;
    let dmg1 = parseInt(values.dmg1)||0;
    let bulk1 = parseInt(values.bulk1)||0;
    let wpntype1 = parseInt(values.wpntype1)||0;
    if (shieldbashradio1 == "1" && wpntype1 == "2") {
        if (bulk1 <= "0") {
            setAttrs({
                "dmg1": 2
            });   
        }
        if (bulk1 == "1") {
            setAttrs({
                "dmg1": 3
            });   
        }
        if (bulk1 >= "2") {
            setAttrs({
                "dmg1": 4
            });   
        }
    }
    if (shieldbashradio1 == "0" && wpntype1 == "2") {
        if (dmg1 == "0" || dmg1 == "2") {
            setAttrs({
                "dmg1": 2
            });          
        }
    }
  });
});

</script>

<script type="text/worker">

on("change:shieldbashradio2 change:dmg2 change:bulk2 change:wpntype2 sheet:opened", function() {  
  getAttrs(["shieldbashradio2","dmg2","bulk2","wpntype2"], function(values) {
    let shieldbashradio = parseFloat(values.shieldbashradio2)||0;
    let dmg = parseInt(values.dmg2)||0;
    let bulk = parseInt(values.bulk2)||0;
    let wpntype = parseInt(values.wpntype2)||0;
    if (shieldbashradio == "1" && wpntype == "2") {
        if (bulk <= "0") {
            setAttrs({
                "dmg2": 2
            });   
        }
        if (bulk == "1") {
            setAttrs({
                "dmg2": 3
            });   
        }
        if (bulk >= "2") {
            setAttrs({
                "dmg2": 4
            });
        }
    }
    if (shieldbashradio == "0" && wpntype == "2") {
        setAttrs({
            "dmg2": 2
        });
    }
  });
});

on("change:shieldbashradio3 change:dmg3 change:bulk3 change:wpntype3 sheet:opened", function() {  
  getAttrs(["shieldbashradio3","dmg3","bulk3","wpntype3"], function(values) {
    let shieldbashradio = parseFloat(values.shieldbashradio3)||0;
    let dmg = parseInt(values.dmg3)||0;
    let bulk = parseInt(values.bulk3)||0;
    let wpntype = parseInt(values.wpntype3)||0;
    if (shieldbashradio == "1" && wpntype == "2") {
        if (bulk <= "0") {
            setAttrs({
                "dmg3": 2
            });   
        }
        if (bulk == "1") {
            setAttrs({
                "dmg3": 3
            });   
        }
        if (bulk >= "2") {
            setAttrs({
                "dmg3": 4
            });   
        }
    }
    if (shieldbashradio == "0" && wpntype == "2") {
        if (dmg == "0" || dmg == "2") {
            setAttrs({
                "dmg3": 2
            });          
        }
    }
  });
});

on("change:shieldbashradio4 change:dmg4 change:bulk4 change:wpntype4 sheet:opened", function() {  
  getAttrs(["shieldbashradio4","dmg4","bulk4","wpntype4"], function(values) {
    let shieldbashradio = parseFloat(values.shieldbashradio4)||0;
    let dmg = parseInt(values.dmg4)||0;
    let bulk = parseInt(values.bulk4)||0;
    let wpntype = parseInt(values.wpntype4)||0;
    if (shieldbashradio == "1" && wpntype == "2") {
        if (bulk <= "0") {
            setAttrs({
                "dmg4": 2
            });   
        }
        if (bulk == "1") {
            setAttrs({
                "dmg4": 3
            });   
        }
        if (bulk >= "2") {
            setAttrs({
                "dmg4": 4
            });   
        }
    }
    if (shieldbashradio == "0" && wpntype == "2") {
        if (dmg == "0" || dmg == "2") {
            setAttrs({
                "dmg4": 2
            });          
        }
    }
  });
});

on("change:shieldbashradio5 change:dmg5 change:bulk5 change:wpntype5 sheet:opened", function() {  
  getAttrs(["shieldbashradio5","dmg5","bulk5","wpntype5"], function(values) {
    let shieldbashradio = parseFloat(values.shieldbashradio5)||0;
    let dmg = parseInt(values.dmg5)||0;
    let bulk = parseInt(values.bulk5)||0;
    let wpntype = parseInt(values.wpntype5)||0;
    if (shieldbashradio == "1" && wpntype == "2") {
        if (bulk <= "0") {
            setAttrs({
                "dmg5": 2
            });   
        }
        if (bulk == "1") {
            setAttrs({
                "dmg5": 3
            });   
        }
        if (bulk >= "2") {
            setAttrs({
                "dmg5": 4
            });   
        }
    }
    if (shieldbashradio == "0" && wpntype == "2") {
        if (dmg == "0" || dmg == "2") {
            setAttrs({
                "dmg5": 2
            });          
        }
    }
  });
});

</script>

<script type="text/worker">

on("change:grapplefinal change:grapplererollmod sheet:opened", function() {  
  getAttrs(["grapplefinal","grapplererollmod"], function(values) {
    let recheck = parseFloat(values.grapplefinal)||0;
    let grapplererollmod = parseInt(values.grapplererollmod)||0;
    let resultreroll = recheck - Math.floor(recheck);
    if(resultreroll == "0") {
        setAttrs({
            "resultrerollgrapple": 0 + grapplererollmod
        });}
    if(resultreroll == "0.5") {
        setAttrs({
            "resultrerollgrapple": 1 + grapplererollmod
    });}
  });
});

on("change:dodgemod change:gracetotalfloat change:dedsta change:defboxbulk change:paraltier change:dodgebuff sheet:opened", function() {  
  getAttrs(["dodgemod","gracetotalfloat","dedsta","defboxbulk","paraltier","dodgebuff"], function(values) {
    let gracetotalfloat = parseFloat(values.gracetotalfloat)||0;
    let dodgebuff = parseInt(values.dodgebuff)||0;
    let dodgemod = values.dodgemod||0;
    let defboxbulk = parseInt(values.defboxbulk)||0;
    let dedsta = parseInt(values.dedsta)||0;
    let dedstabulk = dedsta * defboxbulk;
    let paraltier = parseInt(values.paraltier)||0;
    let paraldebuff = (paraltier >= 2) ? 1 : 0;
    setAttrs({                            
      "dodgetotal": gracetotalfloat + dedsta + dedstabulk + dodgebuff - dodgemod - paraldebuff
    });
  });
});

on("change:parrymod change:mighttotalfloat change:parrybonus change:paraltier change:parrybuff sheet:opened", function() {  
  getAttrs(["parrymod","mighttotalfloat","parrybonus","paraltier","parrybuff"], function(values) {
    let mighttotalfloat = parseFloat(values.mighttotalfloat)||0;
    let parrybuff = parseInt(values.parrybuff)||0;
    let parrymod = parseInt(values.parrymod)||0;
    let parrybonus = parseInt(values.parrybonus)||0;
    let paraltier = parseInt(values.paraltier)||0;
    let paraldebuff = (paraltier >= 2) ? 1 : 0;
    setAttrs({                            
      "parrytotal": mighttotalfloat + parrybonus + parrybuff - parrymod - paraldebuff
    });
  });
});

on("change:might change:loadmod sheet:opened", function() {  
  getAttrs(["might","loadmod"], function(values) {
    let might = parseInt(values.might)||0;
    let loadmod = parseInt(values.loadmod)||0;
    setAttrs({                            
      "load": might + loadmod
    });
  });
});

on("change:might sheet:opened change:mightmod change:bulkcheck change:mightcheckbuff change:mightrerollmod", function() {  
  getAttrs(["might","mightmod","bulkcheck","mightcheckbuff","mightrerollmod"], function(values) {
    let might = parseFloat(values.might)||0;
    let mightmod = parseFloat(values.mightmod)||0;
    let mightcheckbuff = parseInt(values.mightcheckbuff)||0;
    let mightrerollmod = parseInt(values.mightrerollmod)||0;
    let bulkcheck = parseInt(values.bulkcheck)||0;
    let mighttotal = might + mightmod + mightcheckbuff - bulkcheck;
    let mightreroll = mighttotal - Math.floor(mighttotal);
    setAttrs({                            
      "mighttotal": Math.floor(mighttotal)
    });
    setAttrs({                            
      "mighttotalfloat": mighttotal
    });
    if(mightreroll == "0") {
        setAttrs({
            "mightreroll": 0 + mightrerollmod
        });}
    if(mightreroll == "0.5") {
        setAttrs({
            "mightreroll": 1 + mightrerollmod
        });}
  });
});

on("change:grace sheet:opened change:gracemod change:bulkcheck change:gracecheckbuff change:gracererollmod", function() {  
  getAttrs(["grace","gracemod","bulkcheck","gracecheckbuff","gracererollmod"], function(values) {
    let grace = parseFloat(values.grace)||0;
    let gracemod = parseFloat(values.gracemod)||0;
    let gracecheckbuff = parseInt(values.gracecheckbuff)||0;
    let gracererollmod = parseInt(values.gracererollmod)||0;
    let bulkcheck = parseInt(values.bulkcheck)||0;
    let gracetotal = grace + gracemod + gracecheckbuff - bulkcheck;
    let gracereroll = gracetotal - Math.floor(gracetotal);
    setAttrs({                            
      "gracetotal": Math.floor(gracetotal)
    });
    setAttrs({                            
      "gracetotalfloat": gracetotal
    });
    if(gracereroll == "0") {
        setAttrs({
            "gracereroll": 0 + gracererollmod
        });}
    if(gracereroll == "0.5") {
        setAttrs({
            "gracereroll": 1 + gracererollmod
        });}
  });
});

on("change:shell sheet:opened change:shellmod change:shellcheckbuff change:shellrerollmod", function() {  
  getAttrs(["shell","shellmod","shellcheckbuff","shellrerollmod"], function(values) {
    let shell = parseFloat(values.shell)||0;
    let shellmod = parseFloat(values.shellmod)||0;
    let shellcheckbuff = parseInt(values.shellcheckbuff)||0;
    let shellrerollmod = parseInt(values.shellrerollmod)||0;
    let shelltotal = shell + shellmod + shellcheckbuff;
    let shellreroll = shelltotal - Math.floor(shelltotal);
    setAttrs({                            
      "shelltotal": Math.floor(shelltotal)
    });
    setAttrs({                            
      "shelltotalfloat": shelltotal  
    });
    if(shellreroll == "0") {
        setAttrs({
            "shellreroll": 0 + shellrerollmod
        });}
    if(shellreroll == "0.5") {
        setAttrs({
            "shellreroll": 1 + shellrerollmod
        });}
  });
});

on("change:insight sheet:opened change:insightmod change:insightcheckbuff change:insightrerollmod", function() {  
  getAttrs(["insight","insightmod","insightcheckbuff","insightrerollmod"], function(values) {
    let insight = parseFloat(values.insight)||0;
    let insightmod = parseFloat(values.insightmod)||0;
    let insightcheckbuff = parseInt(values.insightcheckbuff)||0;
    let insightrerollmod = parseInt(values.insightrerollmod)||0;
    let insighttotal = insight + insightmod + insightcheckbuff;
    let insightreroll = insighttotal - Math.floor(insighttotal);
    setAttrs({                            
      "insighttotal": Math.floor(insighttotal)
    });
    setAttrs({                            
      "insighttotalfloat": insighttotal
    });
    if(insightreroll == "0") {
        setAttrs({
            "insightreroll": 0 + insightrerollmod
        });}
    if(insightreroll == "0.5") {
        setAttrs({
            "insightreroll": 1 + insightrerollmod
        });}
  });
});

on("change:cute change:cutererollmod sheet:opened", function() {  
  getAttrs(["cute","cutererollmod"], function(values) {
    let cute = parseFloat(values.cute)||0;
    let cutererollmod = parseInt(values.cutererollmod)||0;
    let cutereroll = cute - Math.floor(cute);
    setAttrs({                            
      "cutetotal": Math.floor(cute)
    });
    setAttrs({                            
      "cutetotalfloat": cute
    });
    if(cutereroll == "0") {
        setAttrs({
            "cutereroll": 0 + cutererollmod
        });}
    if(cutereroll == "0.5") {
        setAttrs({
            "cutereroll": 1 + cutererollmod
        });}
  });
});

on("change:spook change:spookrerollmod sheet:opened", function() {  
  getAttrs(["spook","spookrerollmod"], function(values) {
    let spook = parseFloat(values.spook)||0;
    let spookrerollmod = parseInt(values.spookrerollmod)||0;
    let spookreroll = spook - Math.floor(spook);
    setAttrs({                            
      "spooktotal": Math.floor(spook)
    });
    setAttrs({                            
      "spooktotalfloat": spook
    });
    if(spookreroll == "0") {
        setAttrs({
            "spookreroll": 0 + spookrerollmod
        });}
    if(spookreroll == "0.5") {
        setAttrs({
            "spookreroll": 1 + spookrerollmod
        });}
  });
});

on("change:atkboxgrapple change:atkboxopportunity change:atkboxpaired change:atkboxsqueeze change:atkboxunseen change:defboxgrapple change:defboxsqueeze change:defboxunseen change:defboxranged change:defboxmove sheet:opened", function() {  
  getAttrs(["atkboxgrapple","atkboxpaired","atkboxopportunity","atkboxsqueeze","atkboxunseen","defboxgrapple","defboxsqueeze","defboxunseen","defboxranged","defboxmove"], function(values) {
    if(values.atkboxgrapple == "0") {
        setAttrs({
            "grapplemod": 0
        });}
    if(values.atkboxgrapple == "1") {
        setAttrs({
            "grapplemod": 1
        });}
    if(values.atkboxpaired == "0") {
        setAttrs({
            "pairedmod": 0
        });}
    if(values.atkboxpaired == "1") {
        setAttrs({
            "pairedmod": 1
        });}
    if(values.atkboxopportunity == "0") {
        setAttrs({
            "opportunitymod": 0
        });}
    if(values.atkboxopportunity == "1") {
        setAttrs({
            "opportunitymod": 1
        });}
    if(values.atkboxsqueeze == "0") {
        setAttrs({
            "squeezemod": 0
        });}
    if(values.atkboxsqueeze == "1") {
        setAttrs({
            "squeezemod": 1
        });}
    if(values.atkboxunseen == "0") {
        setAttrs({
            "unseenmod": 0
        });}
    if(values.atkboxunseen == "1") {
        setAttrs({
            "unseenmod": 2
        });}
    if(values.defboxgrapple == "0") {
        setAttrs({
            "defgrapplemod": 0
        });}
    if(values.defboxgrapple == "1") {
        setAttrs({
            "defgrapplemod": 1
        });}
    if(values.defboxsqueeze == "0") {
        setAttrs({
            "defsqueezemod": 0
        });}
    if(values.defboxsqueeze == "1") {
        setAttrs({
            "defsqueezemod": 1
        });}
    if(values.defboxunseen == "0") {
        setAttrs({
            "defunseenmod": 0
        });}
    if(values.defboxunseen == "1") {
        setAttrs({
            "defunseenmod": 2
        });}
    if(values.defboxranged == "0") {
        setAttrs({
            "defrangedmod": 0
        });}
    if(values.defboxranged == "1") {
        setAttrs({
            "defrangedmod": 2
        });}
    if(values.defboxmove == "0") {
        setAttrs({
            "defmovemod": 0
        });}
    if(values.defboxmove == "1") {
        setAttrs({
            "defmovemod": 1
        });}

  });
});

on("change:grapplemod change:squeezemod change:pairedmod change:opportunitymod change:unseenmod change:atkboxcovered change:defgrapplemod change:defsqueezemod change:defunseenmod change:defrangedmod change:attackbuff sheet:opened", function() {  
  getAttrs(["grapplemod","squeezemod","pairedmod","opportunitymod","unseenmod","atkboxcovered","defgrapplemod","defsqueezemod","defunseenmod","defrangedmod","attackbuff"], function(values) {
    let grapplemod = values.grapplemod||0;
    let squeezemod = values.squeezemod||0;
    let attackbuff = parseInt(values.attackbuff)||0;
    let opportunitymod = values.opportunitymod||0;
    let pairedmod = values.pairedmod||0;
    let unseenmod = values.unseenmod||0;
    let atkboxcovered = values.atkboxcovered||0;
    let defgrapplemod = values.defgrapplemod||0;
    let defsqueezemod = values.defsqueezemod||0;
    let defunseenmod = values.defunseenmod||0;
    let defrangedmod = values.defrangedmod||0;
    let bulkcheck = values.bulkcheck||0;
    setAttrs({
        "resultmod": grapplemod + squeezemod + pairedmod + opportunitymod + unseenmod + (4 * atkboxcovered) - attackbuff
    });
    setAttrs({
        "dodgemod": defgrapplemod + defsqueezemod + defunseenmod
    });
    setAttrs({
        "parrymod": defgrapplemod + defsqueezemod + defunseenmod + defrangedmod
    });
  });
});

</script>

<script type="text/worker">

on("change:atkequip change:pryequip change:result1 change:result2 change:result3 change:result4 change:result5 change:wpntype1 change:wpntype2 change:wpntype3 change:wpntype4 change:wpntype5 change:qty1 change:qty2 change:qty3 change:qty4 change:qty5 change:dmg1 change:dmg2 change:dmg3 change:dmg4 change:dmg5 change:shieldqtybonus1 change:shieldqtybonus2 change:shieldqtybonus3 change:shieldqtybonus4 change:shieldqtybonus5 change:shieldbashradio1 change:shieldbashradio2 change:shieldbashradio3 change:shieldbashradio4 change:shieldbashradio5 sheet:opened", function() {  
  getAttrs(["atkequip","pryequip","result1","result2","result3","result4","result5","wpntype1","wpntype2","wpntype3","wpntype4","wpntype5","qty1","qty2","qty3","qty4","qty5","dmg1","dmg2","dmg3","dmg4","dmg5","shieldqtybonus1","shieldqtybonus2","shieldqtybonus3","shieldqtybonus4","shieldqtybonus5","shieldbashradio1","shieldbashradio2","shieldbashradio3","shieldbashradio4","shieldbashradio5"], function(values) {
    let atkequip = parseInt(values.atkequip)||0;
    let pryequip = parseInt(values.pryequip)||0;
    let result1 = parseFloat(values.result1)||0;
    let result2 = parseFloat(values.result2)||0;
    let result3 = parseFloat(values.result3)||0;
    let result4 = parseFloat(values.result4)||0;
    let result5 = parseFloat(values.result5)||0;
    let dmg1 = parseInt(values.dmg1)||0;
    let dmg2 = parseInt(values.dmg2)||0;
    let dmg3 = parseInt(values.dmg3)||0;
    let dmg4 = parseInt(values.dmg4)||0;
    let dmg5 = parseInt(values.dmg5)||0;
    let qty1 = parseInt(values.qty1)||0;
    let qty2 = parseInt(values.qty2)||0;
    let qty3 = parseInt(values.qty3)||0;
    let qty4 = parseInt(values.qty4)||0;
    let qty5 = parseInt(values.qty5)||0;
    let wpntype1 = parseFloat(values.wpntype1)||0;
    let wpntype2 = parseFloat(values.wpntype2)||0;
    let wpntype3 = parseFloat(values.wpntype3)||0;
    let wpntype4 = parseFloat(values.wpntype4)||0;
    let wpntype5 = parseFloat(values.wpntype5)||0;
    let shieldqtybonus1 = parseInt(values.shieldqtybonus1)||0;
    let shieldqtybonus2 = parseInt(values.shieldqtybonus2)||0;
    let shieldqtybonus3 = parseInt(values.shieldqtybonus3)||0;
    let shieldqtybonus4 = parseInt(values.shieldqtybonus4)||0;
    let shieldqtybonus5 = parseInt(values.shieldqtybonus5)||0;
    let shieldbashradio1 = parseInt(values.shieldbashradio1)||0;
    let shieldbashradio2 = parseInt(values.shieldbashradio2)||0;
    let shieldbashradio3 = parseInt(values.shieldbashradio3)||0;
    let shieldbashradio4 = parseInt(values.shieldbashradio4)||0;
    let shieldbashradio5 = parseInt(values.shieldbashradio5)||0;

    if(atkequip == "1") {
        setAttrs({
            "result": result1
        });
        setAttrs({
            "dmgcrt": dmg1
        });
        setAttrs({
            "wpntype": wpntype1
        });
        setAttrs({
            "shieldbashcrt": shieldbashradio1
        });
    }
    if(atkequip == "2") {
        setAttrs({
            "result": result2
        });
        setAttrs({
            "dmgcrt": dmg2
        });
        setAttrs({
            "wpntype": wpntype2
        });
        setAttrs({
            "shieldbashcrt": shieldbashradio2
        });
    }
    if(atkequip == "3") {
        setAttrs({
            "result": result3
        });
        setAttrs({
            "dmgcrt": dmg3
        });
        setAttrs({
            "wpntype": wpntype3
        });
        setAttrs({
            "shieldbashcrt": shieldbashradio3
        });
    }
    if(atkequip == "4") {
        setAttrs({
            "result": result4
        });
        setAttrs({
            "dmgcrt": dmg4
        });
        setAttrs({
            "wpntype": wpntype4
        });
        setAttrs({
            "shieldbashcrt": shieldbashradio4
        });
    }
    if(atkequip == "5") {
        setAttrs({
            "result": result5
        });
        setAttrs({
            "dmgcrt": dmg5
        });
        setAttrs({
            "wpntype": wpntype5
        });
        setAttrs({
            "shieldbashcrt": shieldbashradio5
        });
    }
    if(pryequip == "1") {
        setAttrs({
            "parrytype": wpntype1
        });
        setAttrs({
            "qtycrt": qty1 + shieldqtybonus1
        });
    }
    if(pryequip == "2") {
        setAttrs({
            "parrytype": wpntype2
        });
        setAttrs({
            "qtycrt": qty2 + shieldqtybonus2
        });
    }
    if(pryequip == "3") {
        setAttrs({
            "parrytype": wpntype3
        });
        setAttrs({
            "qtycrt": qty3 + shieldqtybonus3
        });
    }
    if(pryequip == "4") {
        setAttrs({
            "parrytype": wpntype4
        });
        setAttrs({
            "qtycrt": qty4 + shieldqtybonus4
        });
    }
    if(pryequip == "5") {
        setAttrs({
            "parrytype": wpntype5
        });
        setAttrs({
            "qtycrt": qty5 + shieldqtybonus5
        });
    }
  });
});

</script>

<script type="text/worker">

on("change:parrytype change:dedsta change:qtycrt change:parryweaponbuff change:parryshieldbuff sheet:opened", function() {  
  getAttrs(["parrytype","dedsta","qtycrt","parryweaponbuff","parryshieldbuff"], function(values) {
    let parrytype = parseInt(values.parrytype)||0;
    let dedsta = parseInt(values.dedsta)||0;
    let qtycrt = parseInt(values.qtycrt)||0;
    let parryweaponbuff = parseInt(values.parryweaponbuff)||0;
    let parryshieldbuff = parseInt(values.parryshieldbuff)||0;
    if(parrytype == "1") {
        if(qtycrt >= dedsta) {
            let parrybonus = dedsta * 2;
            setAttrs({
                "parrybonus": parrybonus + parryweaponbuff
            });    
        }
        if(qtycrt < dedsta) {
            let parrymin = qtycrt * 2;
            let parrybonus = parrymin + dedsta + parryweaponbuff - qtycrt;
            setAttrs({
                "parrybonus": parrybonus
            });    
        }
        
    }
    if(parrytype == "2") {
        let parrybonus = qtycrt + dedsta + parryshieldbuff;
        setAttrs({
            "parrybonus": parrybonus
        });}
  });
});

</script>

<script type="text/worker">

on("change:bulk1 change:bulk2 change:bulk3 change:bulk4 change:bulk5 change:dmg1 change:dmg2 change:dmg3 change:dmg4 change:dmg5 change:rng1 change:rng2 change:rng3 change:rng4 change:rng5 change:qty1 change:qty2 change:qty3 change:qty4 change:qty5 sheet:opened", function() {  
  getAttrs(["bulk1","bulk2","bulk3","bulk4","bulk5","dmg1","dmg2","dmg3","dmg4","dmg5","rng1","rng2","rng3","rng4","rng5","qty1","qty2","qty3","qty4","qty5"], function(values) {
        if(values.bulk1 == 0 && values.dmg1 == 0 && values.rng1 == 0 && values.qty1 == 0) {
            setAttrs({
                "result1zero": 0
            });
        } if(values.bulk1 >= 1 || values.dmg1 >= 1 || values.rng1 >= 1 || values.qty1 >= 1) {
            setAttrs({
                "result1zero": 1
            });
        }
        if(values.bulk2 == 0 && values.dmg2 == 0 && values.rng2 == 0 && values.qty2 == 0) {
            setAttrs({
                "result2zero": 0
            });
        } if(values.bulk2 >= 1 || values.dmg2 >= 1 || values.rng2 >= 1 || values.qty2 >= 1) {
            setAttrs({
                "result2zero": 1
            });
        }
        if(values.bulk3 == 0 && values.dmg3 == 0 && values.rng3 == 0 && values.qty3 == 0) {
            setAttrs({
                "result3zero": 0
            });
        } if(values.bulk3 >= 1 || values.dmg3 >= 1 || values.rng3 >= 1 || values.qty3 >= 1) {
            setAttrs({
                "result3zero": 1
            });
        }
        if(values.bulk4 == 0 && values.dmg4 == 0 && values.rng4 == 0 && values.qty4 == 0) {
            setAttrs({
                "result4zero": 0
            });
        } if(values.bulk4 >= 1 || values.dmg4 >= 1 || values.rng4 >= 1 || values.qty4 >= 1) {
            setAttrs({
                "result4zero": 1
            });
        }
        if(values.bulk5 == 0 && values.dmg5 == 0 && values.rng5 == 0 && values.qty5 == 0) {
            setAttrs({
                "result5zero": 0
            });
        } if(values.bulk5 >= 1 || values.dmg5 >= 1 || values.rng5 >= 1 || values.qty5 >= 1) {
            setAttrs({
                "result5zero": 1
            });
        }
  });
});

on('change:heart sheet:opened', () => {
    getAttrs(['heartmax', 'heart'], function(values) {
        let heartmax = parseInt(values.heartmax)||0;
        let heart = parseInt(values.heart)||0;
        if(heart > heartmax) {
            setAttrs({
                "heart": heartmax
                });
        }
    });
});

on('change:soul sheet:opened', () => {
    getAttrs(['soulmax', 'soul'], function(values) {
        let soulmax = parseInt(values.soulmax)||0;
        let soul = parseInt(values.soul)||0;
        if(soul > soulmax) {
            setAttrs({
                "soul": soulmax
                });
        }
    });
});

on('change:stam change:paraltier sheet:opened', () => {
    getAttrs(['stammax', 'stam', 'paraltier'], function(values) {
        let stammax = parseInt(values.stammax)||0;
        let stam = parseInt(values.stam)||0;
        let paraltier = parseInt(values.paraltier)||0;
        let paralcheck = (paraltier >= 1) ? 1 : 0;
        let stamcheck = stammax - 1;
        if(stam > stammax && paraltier == 0) {
            setAttrs({
                "stam": stammax
                });
        }
        if(stam > stamcheck && paraltier != 0) {
            setAttrs({
                "stam": stamcheck
                });
        }
    });
});

on('change:cust1 sheet:opened', () => {
    getAttrs(['cust1max', 'cust1'], function(values) {
        let custmax = parseInt(values.cust1max)||0;
        let cust = parseInt(values.cust1)||0;
        if(cust > custmax) {
            setAttrs({
                "cust1": custmax
                });
        }
    });
});

on('change:cust2 sheet:opened', () => {
    getAttrs(['cust2max', 'cust2'], function(values) {
        let custmax = parseInt(values.cust2max)||0;
        let cust = parseInt(values.cust2)||0;
        if(cust > custmax) {
            setAttrs({
                "cust2": custmax
                });
        }
    });
});

on('change:cust3 sheet:opened', () => {
    getAttrs(['cust3max', 'cust3'], function(values) {
        let custmax = parseInt(values.cust3max)||0;
        let cust = parseInt(values.cust3)||0;
        if(cust > custmax) {
            setAttrs({
                "cust3": custmax
                });
        }
    });
});

on('change:dedsta change:stam change:stamtemp sheet:opened', () => {
    getAttrs(['dedsta', 'stamtemp', 'stam'], function(values) {
        let stam = parseInt(values.stam)||0;
        let stamtemp = parseInt(values.stamtemp)||0;
        let dedsta = parseInt(values.dedsta)||0;
        let maxdedsta = stam + stamtemp - 1;
        if(maxdedsta <= 0) {
            setAttrs({
                "dedsta": 0
                });
        }
        if((dedsta > maxdedsta) && (maxdedsta != "-1")) {
            setAttrs({
                "dedsta": maxdedsta
                });
        }
    });
});

//on('change:speed change:speedmax sheet:opened', () => {
//    getAttrs(['speed','speedmax'], function(values) {
//        let speedmax = parseInt(values.speedmax)||0;
//        let speed = parseInt(values.speed)||0;
//        if(speed > speedmax) {
//           setAttrs({
//                "speed": speedmax
//                });
//        }
//    });
//});

on('change:gracetotal change:footworkmod sheet:opened', () => {
    getAttrs(['gracetotal','footworkmod'], function(values) {
        let gt = parseInt(values.gracetotal)||0;
        let fwm = parseInt(values.footworkmod)||0;
        let fwt = gt + (fwm * 2);
        let footwork = Math.ceil(fwt / 2);
        setAttrs({
            "footwork": footwork
        });
    });
});

on('change:shelltotal change:beltmod sheet:opened', () => {
    getAttrs(['shelltotal','beltmod'], function(values) {
        let shelltotal = parseInt(values.shelltotal)||0;
        let beltmod = parseInt(values.beltmod)||0;
        let belt = shelltotal + beltmod;
        setAttrs({
            "belt": belt
        });
    });
});


on('change:armdur change:armdurmax sheet:opened', () => {
    getAttrs(['armdur','armdurmax'], function(values) {
        let armdurmax = parseInt(values.armdurmax)||0;
        let armdur = parseInt(values.armdur)||0;
        if(armdur > armdurmax) {
            setAttrs({
                "armdur": armdurmax
                });
        }
    });
});


</script>

<script type="text/worker">

on('change:dr change:armdur change:armsoak change:armsoakreroll sheet:opened', () => {
    getAttrs(['armdur','dr','armsoak','armsoakreroll'], function(values) {
        let armdur = parseInt(values.armdur)||0;
        let armsoak = parseInt(values.armsoak)||0;
        let armsoakreroll = parseInt(values.armsoakreroll)||0;
        let dr = parseInt(values.dr)||0;
        const output = {};
        output.drarb = (armdur > "0") ? dr : 0;
        output.armsoakarb = (armdur > "0") ? armsoak : 0;
        output.armsoakrerollarb = (armdur > "0") ? armsoakreroll : 0;
        setAttrs(output);
    });
});

on('change:soakrerollmod change:armsoakrerollarb change:soakmagicrerollmod change:soakenvirorerollmod change:soakmagicradio change:soakenviroradio change:softbody change:shellreroll sheet:opened', () => {
    getAttrs(["soakrerollmod","armsoakrerollarb","soakmagicrerollmod","soakenvirorerollmod","soakmagicradio","soakenviroradio","softbody","shellreroll"], function(values) {
        let shellreroll = parseInt(values.shellreroll)||0;
        let softbody = parseInt(values.softbody)||0;
        let soakrerollmod = parseInt(values.soakrerollmod)||0;
        let armsoakreroll = parseInt(values.armsoakrerollarb)||0;
        let soakmagicrerollmod = parseInt(values.soakmagicrerollmod)||0;
        let soakenvirorerollmod = parseInt(values.soakenvirorerollmod)||0;
        let soakmagicradio = parseInt(values.soakmagicradio)||0;
        let soakenviroradio = parseInt(values.soakenviroradio)||0;
        let shellrerollcheck = (softbody == 0) ? shellreroll : 0;
        let soakrerollnormal = soakrerollmod + armsoakreroll + shellrerollcheck;
        const output = {};
        output.soakrerollnormal = soakrerollnormal;
        output.soakrerollmagic = (soakmagicradio == "1") ? soakmagicrerollmod + soakrerollnormal : soakmagicrerollmod;
        output.soakrerollenviro = (soakenviroradio == "1") ? soakenvirorerollmod + soakrerollnormal : soakenvirorerollmod;
        setAttrs(output);
    });
});

on("change:softbody change:resistradio change:shelltotal change:armsoakarb change:soakmod change:soakmagicmod change:soakenviromod change:soakmagicradio change:soakenviroradio change:drisk change:drarb change:damredbuff change:damriskbuff change:soakrerollnormal change:soakrerollmagic change:soakrerollenviro sheet:opened", function() {  
  getAttrs(["shelltotal","armsoakarb","soakmod","soakmagicmod","soakenviromod","softbody","soakmagicradio","soakenviroradio","resistradio","drisk","drarb","damredbuff","damriskbuff","soakrerollnormal","soakrerollmagic","soakrerollenviro"], function(values) {
    let dr = parseInt(values.drarb)||0;
    let damredbuff = parseInt(values.damredbuff)||0;
    let damriskbuff = parseInt(values.damriskbuff)||0;
    let drisk = parseInt(values.drisk)||0;
    let dredresult = drisk + damriskbuff - dr - damredbuff;
    const output = {}; // create the output variable to contain the final values.
    output.driskdr = (dredresult <= 0) ? 1 : dredresult;
    setAttrs(output);
    let softbody = parseInt(values.softbody)||0;
    let resistradio = parseInt(values.resistradio)||0;
    let shelltotal = parseInt(values.shelltotal)||0;
    let armsoak = parseInt(values.armsoakarb)||0;
    let soakmod = parseInt(values.soakmod)||0;
    let soakmagicmod = parseInt(values.soakmagicmod)||0;
    let soakenviromod = parseInt(values.soakenviromod)||0;
    let soakrerollnormal = parseInt(values.soakrerollnormal)||0;
    let soakrerollmagic = parseInt(values.soakrerollmagic)||0;
    let soakrerollenviro = parseInt(values.soakrerollenviro)||0;
    let soakmagicradio = parseInt(values.soakmagicradio)||0;
    let soakenviroradio = parseInt(values.soakenviroradio)||0;
    let shellbonus = (softbody == 0) ? shelltotal : 0;
    let shellsoakbonus = soakmod + shellbonus + armsoak;
    let shellsoakbonusmagic = (soakmagicradio == 1) ? (shellsoakbonus + soakmagicmod) : soakmagicmod;
    let shellsoakbonusenviro = (soakenviroradio == 1) ? (shellsoakbonus + soakenviromod) : soakenviromod;
    if(resistradio == 0) {
        setAttrs({
            "soaktotal": shellsoakbonus
        });
        setAttrs({
            "soakreroll": soakrerollnormal
        });
    }
    if(resistradio == 1) {
        setAttrs({
            "soaktotal": shellsoakbonusmagic
        });
        setAttrs({
            "soakreroll": soakrerollmagic
        });
    }
    if(resistradio == 2) {
        setAttrs({
            "soaktotal": shellsoakbonusenviro
        });
        setAttrs({
            "soakreroll": soakrerollenviro
        });
    }
  });
});

</script>

<script type="text/worker">

on('change:absorption change:absorptiondur sheet:opened', () => {
    getAttrs(['absorption','absorptiondur'], function(values) {
        let absorption = parseInt(values.absorption)||0;
        let absorptiondur = parseInt(values.absorptiondur)||0;
        const output = {};
        output.absorptionarb = (absorptiondur > "0") ? absorption : 0;
        setAttrs(output);
    });
});

on("clicked:resist", function(info) {  
  getAttrs(["driskdr","absorptionarb","resistradio","softbody","shelltotal","shellreroll","drisk","soaktotal","soakreroll","setsuccesssoak"], function(values) {
    let soakreroll = parseInt(values.soakreroll)||0;
    let driskdr = parseInt(values.driskdr)||0;
    let drisk = parseInt(values.drisk)||0;
    let absorption = parseInt(values.absorptionarb)||0;
    let radio = parseInt(values.resistradio)||0;
    let soaktotal = parseInt(values.soaktotal)||0;
    let raidoalt  = (radio >= 1) ? 1 : 0;
    if(drisk != 0) {
        let rollString = "&{template:soak} {{name=Soak}} {{rollsoak=[[[[floor(@{soaktotal})]]d6s>@{setsuccesssoak}]]}}";
        if(soakreroll >= "1") {
            rollString += "{{rollsoakr1=[[@{soakreroll}d6>5]]}}";
        } else {
            // this else branch is just to make the later code easier. In your roll temmplate you'd only display it if it has a value > 0
            rollString += "{{rollsoakr1=[[0]]}}";
        }
        startRoll(rollString, results => {
            const roll = results.results.rollsoak.result;
            const reroll_calculated = results.results.rollsoakr1.result;
            const rerollmin = (soaktotal - roll <= 0) ? 0 : soaktotal - roll;
            const reroll = (rerollmin - reroll_calculated <= 0) ? rerollmin : reroll_calculated;
            const total = driskdr - roll - reroll;
            const absconst = ((total <= 0) || (absorption <= 0)) ? 0 : 1;
            const totalfinal = (total <= 0) ? 0 : total;
            const absorbfinal = (absorption >= 1) ? absorption : 1;
            const totalabs = Math.floor(totalfinal / absorbfinal) + absconst;
        finishRoll(results.rollId, {
                rollsoak: totalabs
                });
        });
    }
    if(drisk == 0) {
        let rollString = "&{template:errordrisk} {{name=Errordrisk}} {{rollerrordrisk=[[0]]}}";
        startRoll(rollString, results => {
            finishRoll(results.rollId, {
                });
        });
    }
        setAttrs({
            "drisk": 0
        });
        setAttrs({
            "resistradio": 0
        });
    });
});

</script>

<script type="text/worker">

on("clicked:turn", function() {  
  getAttrs(["dot1","dot2","dot3","stamtax","offbal","heart","stammax","paraltier","paral","speedmax","stamtaxmod","stamtaxinstantmod","bulkcheck","hearttemp"], function(values) {
    let dot1 = parseInt(values.dot1)||0;
    let dot2 = parseInt(values.dot2)||0;
    let dot3 = parseInt(values.dot3)||0;
    let speedmax = parseInt(values.speedmax)||0;
    let stamtax = parseInt(values.stamtax)||0;
    let offbal = parseInt(values.offbal)||0;
    let stammax = parseInt(values.stammax)||0;
    let heart = parseInt(values.heart)||0;
    let hearttemp = parseInt(values.hearttemp)||0;
    let paraltier = parseInt(values.paraltier)||0;
    let paraldebuff = (paraltier >= 1) ? 1 : 0;
    let offbalfinal = (offbal != 0) ? offbal - 1 : 0;
    let dot1final = (dot1 != 0) ? dot1 - 1 : 0;
    let dot2final = (dot2 != 0) ? dot2 - 1 : 0;
    let dot3final = (dot3 != 0) ? dot3 - 1 : 0;
    let heartmath = heart - dot1 - dot2 - dot3;
    let heartmath2 = heart + hearttemp - dot1 - dot2 - dot3;
    let heartfinal = (heartmath < 0) ? 0 : heartmath;
    let stammath = stammax - offbal - paraldebuff;
    let stamfinal = (stammath < 0) ? 0 : stammath;
    setAttrs({
        "offbal": offbalfinal
    });
    setAttrs({
        "dot1": dot1final
    });
    setAttrs({
        "dot2": dot2final
    });
    setAttrs({
        "dot3": dot3final
    });
        if(hearttemp > "0") {
            let heartfinal = (heartmath2 < 0) ? 0 : heartmath2;
            if((hearttemp - dot1 - dot2 - dot3) <= 0) {
                setAttrs({                            
                    "hearttemp": 0
                });
                setAttrs({                            
                    "heart": heartfinal
                });
            } else {
                setAttrs({                            
                    "hearttemp": hearttemp - dot1 - dot2 - dot3
                });
            }
        }
        else {
            let heartfinal = (heartmath < 0) ? 0 : heartmath;
            setAttrs({                            
                "heart": heartfinal
            });  
        }
    setAttrs({
        "stam": stamfinal
    });
    setAttrs({
        "speed": speedmax
    });
  });
});

</script>

<script type="text/worker">

on("clicked:endturn", function() {  
  getAttrs(["se1","se2","se3","stamtax","paral","paraltier","stamtaxmod","stamtaxinstantmod","bulkcheck"], function(values) {
    let se1 = parseInt(values.se1)||0;
    let se2 = parseInt(values.se2)||0;
    let se3 = parseInt(values.se3)||0;
    let bulkcheck = parseInt(values.bulkcheck)||0;
    let stamtaxinstantmod = parseInt(values.stamtaxinstantmod)||0;
    let paral = parseInt(values.paral)||0;
    let paraltier = parseInt(values.paraltier)||0;
    let stamtax = parseInt(values.stamtax)||0;
    let stamtaxmod = parseInt(values.stamtaxmod)||0;
    let se1final = (se1 != 0) ? se1 - 1 : 0;
    let se2final = (se2 != 0) ? se2 - 1 : 0;
    let se3final = (se3 != 0) ? se3 - 1 : 0;
    let parallock = (paraltier >= 3) ? 0 : 1;
    let paralfinal = (paral != 0) ? paral - parallock : 0;
    setAttrs({
        "se1": se1final
    });
    setAttrs({
        "se2": se2final
    });
    setAttrs({
        "se3": se3final
    });
    setAttrs({
        "stamtax": stamtaxmod + bulkcheck + stamtaxinstantmod
    });
    setAttrs({
        "stamtaxnebulous": stamtaxmod + bulkcheck + stamtaxinstantmod
    });
    setAttrs({
        "paral": paralfinal
    });
  });
});

</script>

<script type="text/worker">

on('change:offbal sheet:opened', () => {
    getAttrs(['offbal'], function(values) {
        let offbal = parseInt(values.offbal)||0;
        if(offbal > 3) {
        setAttrs({
            "offbal": 3
        });         
        }
    });
});

on("sheet:opened change:bulk1 change:bulk2 change:bulk3 change:bulk4 change:bulk5 change:bulka change:eqmnt1load change:eqmnt2load change:eqmnt3load change:eqmnt4load change:eqmnt5load change:eqmnt6load change:eqmnt7load change:eqmnt8load change:eqmnt9load change:eqmnt10load", function() {  
  getAttrs(["bulk1","bulk2","bulk3","bulk4","bulk5","bulka","eqmnt1load","eqmnt2load","eqmnt3load","eqmnt4load","eqmnt5load","eqmnt6load","eqmnt7load","eqmnt8load","eqmnt9load","eqmnt10load"], function(values) {
    let bulk1 = parseInt(values.bulk1)||0;
    let bulk2 = parseInt(values.bulk2)||0;
    let bulk3 = parseInt(values.bulk3)||0;
    let bulk4 = parseInt(values.bulk4)||0;
    let bulk5 = parseInt(values.bulk5)||0;
    let bulka = parseInt(values.bulka)||0;
    let eqmnt1load = parseInt(values.eqmnt1load)||0;
    let eqmnt2load = parseInt(values.eqmnt2load)||0;
    let eqmnt3load = parseInt(values.eqmnt3load)||0;
    let eqmnt4load = parseInt(values.eqmnt4load)||0;
    let eqmnt5load = parseInt(values.eqmnt5load)||0;
    let eqmnt6load = parseInt(values.eqmnt6load)||0;
    let eqmnt7load = parseInt(values.eqmnt7load)||0;
    let eqmnt8load = parseInt(values.eqmnt8load)||0;
    let eqmnt9load = parseInt(values.eqmnt9load)||0;
    let eqmnt10load = parseInt(values.eqmnt10load)||0;
    setAttrs({
        "bulktotal": bulk1 + bulk2 + bulk3 + bulk4 + bulk5 + bulka + eqmnt1load + eqmnt2load + eqmnt3load + eqmnt4load + eqmnt5load + eqmnt6load + eqmnt7load + eqmnt8load + eqmnt9load + eqmnt10load
    });
  });
});

on('change:bulktotal sheet:opened', () => {
    getAttrs(['bulktotal','load'], function(values) {
        let bulktotal = parseInt(values.bulktotal)||0;
        let load = parseInt(values.load)||0;
        let loadtotal = load;
        let bulkmax = loadtotal * 2;
        const output = {}; // create the output variable to contain the final values.
        output.bulkcheck = (bulktotal > load) ? 1 : 0;
        setAttrs(output);
        if(bulktotal > bulkmax) {
        setAttrs({
            "bulktotal": bulkmax
        });
        let rollString = "&{template:errorload} {{name=Error}} {{rollerrorload=[[0]]}}";
        startRoll(rollString, results => {
            finishRoll(results.rollId, {
                });
        });
        }
    });
});

on('change:paral sheet:opened', () => {
    getAttrs(['paral'], function(values) {
        let paral = parseInt(values.paral)||0;
        if(paral == "0") {
        setAttrs({
            "paraltier": 0
        });
        }
        if(paral < "5" && paral >= "1") {
        setAttrs({
            "paraltier": 1
        });
        }
        if(paral < "10" && paral >= "5") {
        setAttrs({
            "paraltier": 2
        });
        }
        if(paral < "15" && paral >= "10") {
        setAttrs({
            "paraltier": 4
        });
        }
        if(paral < "20" && paral >= "15") {
        setAttrs({
            "paraltier": 5
        });
        setAttrs({
            "speed": 0
        });
        }
        if(paral >= "20") {
        setAttrs({
            "paraltier": 6
        });
        setAttrs({
            "heart": 0
        });
        }
    });
});

on('change:bulkcheck change:stamtaxinstantmod sheet:opened', () => {
    getAttrs(['bulkcheck','stamtaxinstantmod','stamtaxnebulous'], function(values) {
        let bulkcheck = parseInt(values.bulkcheck)||0;
        let stamtaxnebulous = parseInt(values.stamtaxnebulous)||0;
        let stamtaxinstantmod = parseInt(values.stamtaxinstantmod)||0;
        let stamtaxmath = stamtaxnebulous + stamtaxinstantmod + bulkcheck;
        setAttrs({
            "stamtax": stamtaxmath
        });
    });
});

</script>